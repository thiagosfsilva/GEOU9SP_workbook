<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GEOU9SP GIS Workbook - 6&nbsp; Lab 6: The raster calculator and other rastery bits</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./sec_w4_cartography.html" rel="next">
<link href="./lab_rasters_1.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./sec_w3_rasters.html">Week 3 - Raster data</a></li><li class="breadcrumb-item"><a href="./lab_rasters_2.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Lab 6: The raster calculator and other rastery bits</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GEOU9SP GIS Workbook</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sec_w1_intro_toGIS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 1 - Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Lab 1: QGIS overview and file management</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_crs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Lab 2: Coordinate Reference Systems</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sec_w2_vectors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 2 - Vector data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_vectors_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Lab 3: Working with vector attributes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_vectors_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Lab 4: Working with vector geometries</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sec_w3_rasters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 3 - Raster data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_rasters_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Lab 5: Working with raster data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_rasters_2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Lab 6: The raster calculator and other rastery bits</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Week 4 - Making maps</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sec_w5_spatial_analysis_I.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 5 - Spatial analysis I</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_geoprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Lab 9: Geoprocessing tools</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Week 6 - Spatial analysis II</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Week 8 - Spatial analysis III</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Week 10 - Obtaining spatial data in the field</span></span>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#before-you-start" id="toc-before-you-start" class="nav-link active" data-scroll-target="#before-you-start"><span class="header-section-number">6.1</span> Before you start!</a></li>
  <li><a href="#guided-exercise-1---using-the-raster-calculator" id="toc-guided-exercise-1---using-the-raster-calculator" class="nav-link" data-scroll-target="#guided-exercise-1---using-the-raster-calculator"><span class="header-section-number">6.2</span> Guided Exercise 1 - Using the Raster Calculator</a>
  <ul class="collapse">
  <li><a href="#recovering-your-data" id="toc-recovering-your-data" class="nav-link" data-scroll-target="#recovering-your-data"><span class="header-section-number">6.2.1</span> Recovering your data</a></li>
  <li><a href="#gobal-raster-statistics" id="toc-gobal-raster-statistics" class="nav-link" data-scroll-target="#gobal-raster-statistics"><span class="header-section-number">6.2.2</span> Gobal raster statistics</a></li>
  <li><a href="#per-pixel-calculations-with-the-raster-calculator" id="toc-per-pixel-calculations-with-the-raster-calculator" class="nav-link" data-scroll-target="#per-pixel-calculations-with-the-raster-calculator"><span class="header-section-number">6.2.3</span> Per-pixel calculations with the raster calculator</a></li>
  <li><a href="#boolean-logical-operations-with-the-raster-calculator" id="toc-boolean-logical-operations-with-the-raster-calculator" class="nav-link" data-scroll-target="#boolean-logical-operations-with-the-raster-calculator"><span class="header-section-number">6.2.4</span> Boolean (logical) operations with the raster calculator</a></li>
  <li><a href="#raster-reclassification" id="toc-raster-reclassification" class="nav-link" data-scroll-target="#raster-reclassification"><span class="header-section-number">6.2.5</span> Raster reclassification</a></li>
  <li><a href="#band-vs.-band-raster-calculations" id="toc-band-vs.-band-raster-calculations" class="nav-link" data-scroll-target="#band-vs.-band-raster-calculations"><span class="header-section-number">6.2.6</span> Band vs.&nbsp;band raster calculations</a></li>
  <li><a href="#guided-exercise-x---mosaicking-and-stacking-rasters" id="toc-guided-exercise-x---mosaicking-and-stacking-rasters" class="nav-link" data-scroll-target="#guided-exercise-x---mosaicking-and-stacking-rasters"><span class="header-section-number">6.2.7</span> Guided Exercise X - Mosaicking and Stacking rasters</a></li>
  <li><a href="#raster-image-stretching" id="toc-raster-image-stretching" class="nav-link" data-scroll-target="#raster-image-stretching"><span class="header-section-number">6.2.8</span> Raster image stretching</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./sec_w3_rasters.html">Week 3 - Raster data</a></li><li class="breadcrumb-item"><a href="./lab_rasters_2.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Lab 6: The raster calculator and other rastery bits</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-labras2" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Lab 6: The raster calculator and other rastery bits</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>….</p>
<section id="before-you-start" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="before-you-start"><span class="header-section-number">6.1</span> Before you start!</h2>
<ol type="1">
<li>Go through the Week 3 preparatory session on Canvas, and watch the seminar recording if you have missed it. Also make sure you have completed all labs prior to this one.</li>
</ol>
</section>
<section id="guided-exercise-1---using-the-raster-calculator" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="guided-exercise-1---using-the-raster-calculator"><span class="header-section-number">6.2</span> Guided Exercise 1 - Using the Raster Calculator</h2>
<p>In this exercise, we will use the layers from the previous lab to learn about raster statics and the raster calculator. Then we will learn about mosaicking, stacking and adjusting the contrast of raster layers, and see the effects of using different <em>resampling</em> methods when working with rasters.</p>
<section id="recovering-your-data" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="recovering-your-data"><span class="header-section-number">6.2.1</span> Recovering your data</h3>
<p>At the end of last week’s lab you saved the final results of your project as a zipfile. Retrieve this file, extract the contents, and re-open your project. It should have the four layers in it:</p>
<ul>
<li>Vector polygon of the Island of Great Britain</li>
<li>Raster file of the SRTM digital elevation model (reprojected to EPSG27700 and masked to the GB island)</li>
<li>Raster file of the CORINE digital elevation modelland cover dataset (reprojected to EPSG27700 and masked to the GB island)</li>
<li>Raster file of the BIOCLIM climatic dataset (reprojected to EPSG27700 and masked to the GB island)</li>
</ul>
</section>
<section id="gobal-raster-statistics" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="gobal-raster-statistics"><span class="header-section-number">6.2.2</span> Gobal raster statistics</h3>
<p>Winter is coming, and you want to escape the worst of the cold and rain. You therefore decide to use your GIS skills to find the ideal place to spend your winter - an urban or periurban place with the lowest precipitation and highest minimum temperatures in the UK.</p>
<p>To get started, you want to know the range of precipitation and temperature values for the entire island, using the BIOCLIM data. If this was a vector dataset, you would use <code>Statistical Summary Tool</code> - but it is a raster. What would be the equivalent operation?</p>
<ol class="example" type="1">
<li><p>The tool we need is called <code>Raster Layer Statistics</code>, but it is <em>not</em> located in the <code>Raster</code> menu. Instead, we need to launch the <code>Processing</code> panel ( ADD ICON). This panel contains a lot of additional GIS functions, and we will use if often now.</p></li>
<li><p>Once you have <code>Processing</code> panel open, you can either search for <code>Raster Layer Statistics</code> or find it under rhe <code>Raster analysis</code> heading. Double click on it to launch the tool window. It should look like this:</p></li>
</ol>
<p><img src="images/lab_6/lab_6_fig1_rasterstats.jpg" class="img-fluid"></p>
<p>Looking at the BIOCLIM data description, you need to get statistics for BIO6 - Minimum Temperature of the Coldest Month, and BIO12 - Annual Precipitation. The BIO variables are ordered in the file, so <em>band 6</em> is BIO6, and <em>Band 12</em> is BIO12.</p>
<ol start="3" class="example" type="1">
<li>In the <code>Raster Layer Statistics</code> window, select the BIOCLIM layer as <code>Input Layer</code> and <code>band 06</code> as band number. You can keep the results as a temporaty file. <code>Run</code> it and <code>Close</code> the window. A new panel will have appeared under the <code>Processing</code> panel, called <code>Results Viewer</code>. It will have an entry called <code>Statistics</code>. Double click on it and take note of the minimum and maximum BIO6 values (-75 and 33).</li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>Do these values seem too extreme for the UK? What is going on here?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The metadata for the BIO layers states that temperature values are scaled by a factor of 10, so you need to divide these numbers by 10 to get proper Celsius units.</p>
</div>
</div>
</div>
<ol start="4" class="example" type="1">
<li>Now repeat the process to get the Min and Max values for BIO12 (532 and 2311)</li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>What are the units for precipitation?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The metadata for the BIO layers states that annual precipitation is given in mm. One milimitre of rain is equal to one liter per squared metre.</p>
</div>
</div>
</div>
</section>
<section id="per-pixel-calculations-with-the-raster-calculator" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="per-pixel-calculations-with-the-raster-calculator"><span class="header-section-number">6.2.3</span> Per-pixel calculations with the raster calculator</h3>
<p>Although it is easy enough to covert the temperature pixel values to Celsius in our heads, it would be useful to have the data in the proper units, especially if we want to map it later. Let us use the <code>Raster Calculator</code> to apply the conversion factor to all pixels.</p>
<ol start="5" class="example" type="1">
<li>Go to <code>Raster &gt; Raster Calculator</code> or click on the () button to launch the calculator. It will look like this:</li>
</ol>
<p><img src="images/lab_6/lab_6_fig2_rastercalc.jpg" class="img-fluid"></p>
<p>The general idea is similar to the <code>Field Calculator</code>, with a slightly different layout. The top right panel lists all raster <em>bands</em> in the project (so <code>UK_bioclim_BG_GBmasked@19</code> means band 19 of the BIOCLIM raster). The top right panel lets us pick some options for our raster creation, and the bottom panel let’s us type expressions.</p>
<ol start="6" class="example" type="1">
<li><p>We need to divide all BIO6 temperature values by 10. Double click on the BIOCLIM band 6 in the bands list to add it to the expression panel, and then add the division by <code>10</code>. On my project, the expression panel looks like <code>"UK_bioclim_BG_GBmasked@6" / 10</code>, but your BIOCLIM layer may not be named the same as mine. Note that the bottom of the expression panel should say <code>Expression Valid</code>. If it says <code>Expression Invalid</code>, check your typing (did you use the double quotes?)</p></li>
<li><p>For <code>Output Layer</code>, click on the <code>...</code> button and pick a folder so save the new file. Name it <code>UK_bioclim_BG_GBmasked_BIO6.tif</code>. Leave the rest as default and click in <code>OK</code>.</p></li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>How many bands has your newly created file?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Only one band, holding the results of the calculation.</p>
</div>
</div>
</div>
<p>Every time you enter an expression involving a raster band and a single number in the <code>Raster Calculator</code> you are telling QGIS to apply the same expression to each pixel of that band. In our case, we dividided all pixel values by 10.</p>
</section>
<section id="boolean-logical-operations-with-the-raster-calculator" class="level3" data-number="6.2.4">
<h3 data-number="6.2.4" class="anchored" data-anchor-id="boolean-logical-operations-with-the-raster-calculator"><span class="header-section-number">6.2.4</span> Boolean (logical) operations with the raster calculator</h3>
<p>The <code>Raster Calculator</code> also fulfills the role of the vector <code>Select by expression</code> tool for rasters. The result of any raster logical operation is either <code>1</code> (True) or <code>0</code> (False), i.e.&nbsp;a <em>binary raster</em>, sometimes called a <em>raster mask</em>.</p>
<p>Let us find the warmer places in Great Britain. Our highest minimum temperature of the coldest month (BIO6) value was 3.3 degrees. Let us limit our search to any place that doesn’t go below 0 Celsius.</p>
<ol start="8" class="example" type="1">
<li>Open the <code>Raster Calculator</code> again, and this time use the expression <code>" UK_bioclim_BG_GBmask_BIO6@1" &gt; 0</code>. Save it in a proper folder with the name <code>GB_mintemp_gt_0.tif</code> (gt for ‘greater than’) and run the calculation. You should get something like this:</li>
</ol>
<p><img src="images/lab_6/lab_6_fig3_mintemp_gt_0.jpg" class="img-fluid"> By default, QGIS will paint pixels with a value of <code>1</code> white, and <code>2</code> black. So the white areas now show us all regions of Great Britain that <em>on average</em> don’t go below zero in the worst of winter (these are long term climatic averages). Use the <code>Identify Features</code> tool to check if the pixel values are really <code>0</code> and <code>1</code>.</p>
<ol start="9" class="example" type="1">
<li>Now repeat the process for the precipitation layer. Our minimum annual precipitiation value was just above 500, so let us limit us to areas under 700mm of precipitation. Save the result as <code>GB_precip_lt_700.tif</code>.</li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>You may get a result that shows all of GB as white. This is because the calculator picks the lowest possible floating point number (<span class="math inline">\(-3.40282 \times 10^{+38}\)</span>) as nodata value, and then QGIS sets this value as black instead.</p>
</div>
</div>
</section>
<section id="raster-reclassification" class="level3" data-number="6.2.5">
<h3 data-number="6.2.5" class="anchored" data-anchor-id="raster-reclassification"><span class="header-section-number">6.2.5</span> Raster reclassification</h3>
<p>If we use the above raster with this extreme low number, we will get calculation errors. So before we proceed with our analysis, lets fix it.</p>
<ol start="10" class="example" type="1">
<li>We will use a tool from the <code>Processing</code> panel called <code>Reclassify by table</code>, also under the <code>Raster Analysis</code> heading. Find the tool and open it, and you will see this:</li>
</ol>
<p><img src="images/lab_6/lab_6_fig4_rec_by_table.jpg" class="img-fluid"></p>
<ol start="11" class="example" type="1">
<li>Pick <code>GB_precip_lt_700</code> as your <code>Raster layer</code>, and <code>band 1</code> as your <code>Band Number</code>. Then click on the <code>...</code> button besides the box for <code>Reclassification  table</code>, and fill the table like this:</li>
</ol>
<p><img src="images/lab_6/lab_6_fig5_rec_table.jpg" class="img-fluid"></p>
<ol start="12" class="example" type="1">
<li>Click on te blue arroew to go back to main tool window, then set the <code>nodata value</code> to <code>0</code>, the <code>Range Boundaries</code> to <code>min &lt;= value &lt;= max</code> and the <code>Output Data Type</code> to <code>Byte</code>. Save it as <code>GB_precip_lt_700_reclass.tif</code>. .</li>
</ol>
</section>
<section id="band-vs.-band-raster-calculations" class="level3" data-number="6.2.6">
<h3 data-number="6.2.6" class="anchored" data-anchor-id="band-vs.-band-raster-calculations"><span class="header-section-number">6.2.6</span> Band vs.&nbsp;band raster calculations</h3>
<p>We now have two <em>raster masks</em> showing us all the GB areas that don’t go below zero Celsius and have less than 700mm of rain. How can we combine them into a single layer?</p>
<p>The answer to the above question is still the <code>Raster Calculator</code>. We know the pixels we ‘want’ are numbered <code>1</code> on each layer, otherwise they are <code>0</code>. So if we could multiply one layer by the other, i.e.&nbsp;multiply the value of each pair of corresponding pixels, we would get a new raster whith values of <span class="math inline">\(1 \times 1 = 1\)</span> when both conditions are met, and a result of <span class="math inline">\(0 \times 1 = 1 \times 0 = 0 \times 0 = 0\)</span> if only one or none of the conditions are met. To do this in the <code>Raster Calculator</code> is as simple as it sounds:</p>
<ol start="13" class="example" type="1">
<li>Open the <code>Raster Calculator</code> and enter the expression `</li>
</ol>
</section>
<section id="guided-exercise-x---mosaicking-and-stacking-rasters" class="level3" data-number="6.2.7">
<h3 data-number="6.2.7" class="anchored" data-anchor-id="guided-exercise-x---mosaicking-and-stacking-rasters"><span class="header-section-number">6.2.7</span> Guided Exercise X - Mosaicking and Stacking rasters</h3>
<p>As raster files are often very large and ‘heavy’, it is common to distribute them as <em>tiles</em> or <em>scenes</em>, i.e.&nbsp;smaller adjacent pieces that can be merged back together to cover a certain area of interest. And for satellite images, it is also common for each image band to be stored as a separate file. In this exercise, we will learn how to a) <em>mosaic</em> rasters - merge them together side by side to cover a largear and b) <em>stack</em> rasters - merge the different band files into a single file.</p>
<ol start="14" class="example" type="1">
<li>Download the data from this link. It contains four aerial images covering the Universoty of Stirling Campus and the Wallace Monument area. Extract the data and organise it.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>These images were originally downloaded from the ‘Aerial’ section of Digimap - if you ever need very detailed imagery of the UK surface, check it out!|</p>
</div>
</div>
<ol start="15" class="example" type="1">
<li>Each image is within its own folder, named <code>nsXXXX</code>, where <code>XXXX</code> is a four digit number. Load into QGIS all the <code>.tif</code> files in all four folders. There should be six files in total.</li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>What do you think is the meaning of the <code>nsXXXX</code> folder names?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>They indicate tiles in the OS British Grid system.</p>
</div>
</div>
</div>
<p>Notice that the airphoto for tile ns8196 has been provided with its three colour bands (RGB) as separate files. To be able to see them in colour, we must first <em>stack</em> these bands into a single file. The operation is called stack because you could visualise it as physically stacking them one on top of the other.</p>
<ol start="16" class="example" type="1">
<li>Go to <code>Raster &gt; Miscellaneous &gt; Merge...</code>. You will get a window like this:</li>
</ol>
<p><img src="images/lab_6/lab_6_fig6_merge.jpg" class="img-fluid"> (@) For <code>Input Layers</code>, click on the <code>...</code> button, and a list of all available raster layers will appear. You can drag the layer names to reorder them, and your final selection should the <code>ns8196_R</code>, <code>ns8196_G</code>, and <code>ns8196_B</code> layers, in this order from top to bottom:</p>
<p><img src="images/lab_6/lab_6_fig7_merge_layers.jpg" class="img-fluid"> (@) Once you have selected the layers, click on the blue arrow to go back to the main window, then set the following parameters: check the box for <code>Place each input file into a separate band</code> (that tells QGIS you want a <em>stack</em>), and the <code>Output Data Type</code> to <code>Byte</code>. Then save the resulting file as <code>ns8196_RGB.tif</code> in the same folder where you had the three separate band files.</p>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>Why do we change <code>Output Data Type</code> to <code>Byte</code>?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The RGB colour system uses one byte (8-bits, 0-255 integer numbers) per colour channel to designate any colour. For example, the University of Stirling official green colour is R G B . the <code>Byte</code> option ensure we only use 8-bits per band, and keep the file size smaller. If we left it as <code>Float32</code>, the same 0-225 integer numbers would be stored as 32bit decimal numbers, quadrupling the size of the file for no reason.</p>
</div>
</div>
</div>
<ol start="17" class="example" type="1">
<li>You should now have a properly colored image. Remove the three original single band layers from the project and then save it.</li>
</ol>
<p>Everything looks good colour-wise now, bur our airphoto is still actually four separate adjacent photos. That means anything processing we may want to do involving the entire area would have to be repeated four times. But we can combine these four tiles in a single airphoto <em>mosaic</em>.</p>
<ol start="18" class="example" type="1">
<li><p>Go back to <code>Raster &gt; Miscellaneous &gt; Merge...</code>. It is a bit confusing, but QGIS uses the same tool for both stacking and mosaicking.</p></li>
<li><p>This time, check the four tiled RGB images as your <code>Input Layers</code>. Then make sure to <strong>not check</strong> the <code>Place each input file into a separate band</code> option this time. That will tell QGIS you want a mosaic and not a stack. Set the <code>Output Data Type</code> to <code>Byte</code> again, and save it as <code>UoS_RGB_mosaic.tif</code>. You should now have a single airphoto layer covering the entire area. Remove the previous individual layers from the project and save it again.</p></li>
</ol>
</section>
<section id="raster-image-stretching" class="level3" data-number="6.2.8">
<h3 data-number="6.2.8" class="anchored" data-anchor-id="raster-image-stretching"><span class="header-section-number">6.2.8</span> Raster image stretching</h3>
<p>When working with multiband color images in a GIS environment, we can often manipulate the contrast of an image by applying different <em>contrast stretches</em> to each band. Especially when working with satellite images, which tend to look a bit ‘faded’ because of the atmospheric effect, sretching can make our images more vivid and easier to intepret.</p>
<ol start="20" class="example" type="1">
<li>Right-click on the airphoto mosaic layers and go to <code>Propertiers &gt; Symbology</code>. You will se that the symbology type is <code>Multiband color</code>, which is the correct choice for representing images. Note that each band is associated to a colour channel (R, G, B), but this association can be changed at will. Change the <code>Red band</code> to band 2, and the <code>Green band</code> to band 1, and <code>Apply</code>. Now the vegetation appears red! Change it back to the proper colour order and <code>Apply</code> again.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is a useful feature when working with satellite images, which often have bands representing spectral regions that we cannot see, such as Near Infrared or Microwave. We can then freely associate these bands to color channels and create <code>false colour compositions</code> that highlight different surface features. The example below shows the UoS campus as seen from the Sentinel-2 satellite. The Red band is actually represented in the blue channel, while the green colour is used to show the Near-Infrared band (NIR), and the red channel is used to represent the Short-Wave Infrared Band (SWIR). Since water reflects visible light and absorbs IR, the loch appears blue. Plants reflect mostly in the NIR region so appear green, and bare ground reflects mostly in the SWIR, thus appearing red.</p>
<p>(INSERT UOS SENTINEL IMAGE)</p>
</div>
</div>
<ol start="21" class="example" type="1">
<li><p>Notice how the <code>Min</code> and <code>Max</code> values for each band are <code>0</code> and <code>255</code>, meansing we are mapping our screen colours to the entire range of possible values (0-255). But quite often the colours in an image do not cover the entire range, so we are ‘wasting’ colour discrimination.</p></li>
<li><p>Change the <code>No Enhancement</code> option to <code>Stretch to Min/Max</code>, and then expand the <code>Min/Max Value Settings</code> heading. Pick the <code>Min/Max</code> option, and select <code>Whole Raster</code> for <code>Statistics Extent</code> and <code>Actual(slower)</code> for <code>Accuracy</code>, then click on <code>Apply</code>. You will see that while band 1 and band 3 do use the entire 0-255 range, band 2 uses the 2-255 range only.</p></li>
</ol>
<p>To further enhance the contrast of images, we can tell QGIS to ‘cut off’ the extreme values of the range, using different methods.</p>
<ol start="23" class="example" type="1">
<li><p>Change the <code>Min/Max Value Settings</code> option to <code>Cumulative Count Cut</code>, and then<code>Apply</code>. Now the <code>Min</code> and <code>Max</code> color values for each band are (13-189, 29-187,and 31-164 respectively), and the image should look more vivid. What QGIS did was remove the lowest 2% (2% percentile) and the highest 2% (98% percentile) values from the calculation of Min/Max values, thus <em>stretching</em> this smaller number range to the full colour range of the screen.</p></li>
<li><p>Progressively increase the lower percentile (i.e.&nbsp;from 2% to 3%) and decrease the upper percentile (i.e.&nbsp;from 98% to 97%) and notice how the contrast gets progressively stronger. If you go too far (i.e.&nbsp;too narrow a range, you start to see <em>pixel saturation</em> - many of the pixels will be outside the range and thus mapped to fully black or fully white).</p></li>
</ol>
<p>A second way to calculate the stretch is to use standard deviations. You may remember from statistics that when you assume a Normal distribution, a distance of <span class="math inline">\(\pm 1 \sigma\)</span> from the mean will capture about 68% of the data, <span class="math inline">\(\pm 2 \sigma\)</span> will capture 98%, <span class="math inline">\(\pm 3 \sigma\)</span> will capture X % and so on:</p>
<p>INSERT FIG SD</p>
<ol start="25" class="example" type="1">
<li><p>Change the <code>Min/Max Value Settings</code> option to <code>Mean +/- Standard Deviation x</code>, and leave the multiplier at <code>2</code>. Aplly and check the contrast. Then change the multiplier to <code>1</code> and <code>Apply</code>, and compare the contrast of using <span class="math inline">\(\pm 1 \sigma\)</span> vs.&nbsp;<span class="math inline">\(\pm 2 \sigma\)</span>.</p></li>
<li><p>Set the final image contrast to your linking, and exit the <code>Properties</code> window. Save your project.</p></li>
</ol>
<p>Return to the Symbology window, and expand the option Min / Max Value Settings. What is the default option selected? Experiment with the other options (with different percent clips and standard deviations) and see how the Symbology changes. Remember to Apply the changes every time you change any options. Still, on the Symbology window, change the Classification options (drop-down menu to the left, under the classes) from Continuous to Equal Interval. To the right of it, select the number of classes as 3. Then Apply and evaluate. Without changing your number of classes, change the Interpolation option above the classes from Linear to Discrete. Apply and evaluate. Take some time to play with these visualisation options to analyse the distribution of different Bioclimatic variables in the UK, and think about what they mean for plants, (non-human) animals and in terms of social and economic factors. Finally, let’s work on the Symbology for the SRTM data. On the Symbology window, choose the Singleband Pseudocolor option, and then on the Color Ramp option, select Create New Color Ramp. On the small options window that comes up, select Catalog:cpt-city. Once the catalogue window opens, go to the Topography list and select the cd-a palette. Then classify your elevation values using the User Defined Min /Max option, and type 0 as Min and 900 as Maximum. Apply and visualise. Then, before closing the Properties window, go to the Transparency table and drag the slider at the top to around 60%.</p>
<p>Right-click on the SRTM layer name and select Duplicate layer (this step is useful to create a copy of a layer and retain symbology. Remember, this is a temporary layer). Now, on the Symbology of the copied layer, change the render type to Hillshade. Apply and close the window. Make sure the copied layer is immediately under the original layer, and alternate each layer between on and off.</p>
<p>Stop and think:</p>
<p>What does the hillshade render style does? You may zoom in on an area of interest and examine how the topographical data appear now. Guided Exercise 3 - Mathematical and boolean operations using the Raster CalculatorLinks to an external site. Go to the menu Raster &gt; Raster Calculator…. This tool allows you to apply several mathematical functions to raster layer values and even to do calculations among values.</p>
<p>First, find the Bio1 layer of the Bioclim raster. From the metadata, we know it is the first band, so double-click UK_bioclim@1 to add it to the expression area. In this context <span class="citation" data-cites="1">@1</span>, <span class="citation" data-cites="2">@2</span>, etc. indicate the respective raster band number.</p>
<p>As we saw above, the Bio1 layer corresponds to Annual Average Temperature, with a unit of degrees Celsius multiplied by ten. Let’s convert it to regular degree Celsius units. On the expression area, after UK_bioclim@1, use the operator / then write 10. Then, in the top right corner, select a folder to save your file and name it appropriately (e.g.&nbsp;UK_bioclim_C.tif). Then click OK.</p>
<p>Style your new layer in the same style used for the original Bio1 layer, using the full Min / Max range, and observe the laughable maximum average temperature values for the UK (sorry, couldn’t resist). Can you spot the London heat island effect (urban heat island - UHILinks to an external site.)? Can you recognise other heat islands?</p>
<p>Let us say we would like to relocate to the hottest (in average) locations in the UK. Go back to the raster calculator, and enter the expression UK_bioclim@1 &gt; 100 (or use your new layer and select areas &gt; 10). Save the result as UKs_last_hope.tif. (or more likely future_tropical_UK.tif, considering the heat waves during the last summer 2022).</p>
<p>Go to the Symbology layer of your newly created layer and select Paletted / Unique Values, then Classify. Then, remove the 0 values from the legend using the - (minus) button. Click on the colour box for the 1 values and select a strong red colour. Finally, go to the Transparency tab and drag the slider to around 50%. Then Apply and close the window. Position your temperature range layer just above the terrain + hillshade layers, and make sure only these three layers are visible. Pretty, isn’t it?</p>
<p>Optional: add the UK counties layer from hereLinks to an external site.. Symbolise using “outline”, no fill. Make sure the counties layer appears on the top. Can you identify the counties with the highest average temperature?</p>
<p>For example, let’s say we want to get the mean average annual temperature and visualize the temperature ranges for our “last hope” region only. Let us go to the Raster Calculator, and use the expression (UK_Biolcim@1 / 10) * UKs_last_hope@1. Name the resulting layer and save it, then style the result using a Pseudocolor colour ramp. However, this time manually specify the Min value as 10. It may take a few minutes, so be patient.</p>
<p>Stop and think:</p>
<p>What happened to the temperature values when we applied the expression above? Use the information tool to probe a few values of the new raster to help you think about it. Return to the Properties of the new masked layer, and select the Transparency tab. On the table named Transparent pixel list, click on the + (plus) button to add a new line. Fill the line with the values from = 0, to = 0 and Percent Transparent = 100. Apply and evaluate the result. Stop and think: did you actually change the values of the raster layer when you set the transparent pixels?</p>
<p>Vectors can also be used as masks. Go to Raster &gt; Extraction &gt; Clip Raster by Mask Layer…. Select your Celsius converted average temperature raster as input layer, the gadm36_GBR_0 as your mask layer, and check the keep the resolution of the input raster box. Run the algorithm (it will take a while) then Close the window when finished. Set the transparency to 60%. Zoom to the original UK_SRTM layer extent and compare the results before and after the masking.</p>
<p>Now click on the menu Processing &gt; Toolbox…. Welcome to the QGIS toolbox! You will find many additional functions here to process vectors and rasters, as well as functions from external software that can be accessed through QGIS. On the search bar at the top, search for Raster layer zonal statistics. Double-click on the tool with the name that comes up from the search. As Input layer, select the degree Celsius temperature layer you created, and as Zones layer, select the “last hope” layer (the one with the 0/1 values, not the masked temperature layer). Run (it will take a while) and then Close.</p>
<p>Open the attribute table of the new “statistics” layer and see what the number represents. Independent Exercise Is there any difference in mean values of average annual temperature between urban areas and forests in the UK? Make a map (including legend and scale) showing your results visually.</p>
<p>Hint 1: To ensure raster operations work properly, all rasters must be in the same projection.</p>
<p>Hint 2: You can also use AND and OR to create compound expressions (such as raster@1 &gt; 20 OR raster@2 &lt; 50) on the raster calculator (just make sure you type them in all caps).</p>
<p>Optional: Open a new project. Add the online Mapzen Global Elevation layer by going to the QGIS Browser and choosing XYZ Tiles &gt; Mapzen Global Elevation, and then download the plate tectonic data from HERE Download HERE.</p>
<p>Image showing where to load the Mapzen layer on the QGIS Browser</p>
<p>Open the properties of the DEM and select the Hillshade symbology, with a Z factor of 10. Add the earthquake and country data from Week 2. Now see if there are any clear relationships between high elevations, plate boundaries and earthquake locations.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./lab_rasters_1.html" class="pagination-link" aria-label="Lab 5: Working with raster data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Lab 5: Working with raster data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./sec_w4_cartography.html" class="pagination-link" aria-label="Week 4 - Making maps">
        <span class="nav-page-text">Week 4 - Making maps</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>