<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GEOU9SP GIS Workbook - 6&nbsp; Lab 6: The raster calculator and other rastery bits</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./sec_w4_cartography.html" rel="next">
<link href="./lab_rasters_1.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./sec_w3_rasters.html">Week 3 - Raster data</a></li><li class="breadcrumb-item"><a href="./lab_rasters_2.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Lab 6: The raster calculator and other rastery bits</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GEOU9SP GIS Workbook</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sec_w1_intro_toGIS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 1 - Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Lab 1: QGIS overview and file management</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_crs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Lab 2: Coordinate Reference Systems</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sec_w2_vectors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 2 - Vector data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_vectors_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Lab 3: Working with vector attributes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_vectors_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Lab 4: Working with vector geometries</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sec_w3_rasters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 3 - Raster data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_rasters_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Lab 5: Working with raster data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_rasters_2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Lab 6: The raster calculator and other rastery bits</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sec_w4_cartography.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 4 - Making maps</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_carto_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Lab 7: Making Maps - Part I</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_carto_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Lab 8: Making Maps - Part II</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sec_w5_spatial_analysis_I.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 5 - Spatial analysis I</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_geoprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Lab 9: Geoprocessing tools</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Week 6 - Spatial analysis II</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Week 8 - Spatial analysis III</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Week 10 - Obtaining spatial data in the field</span></span>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#before-you-start" id="toc-before-you-start" class="nav-link active" data-scroll-target="#before-you-start"><span class="header-section-number">6.1</span> Before you start!</a></li>
  <li><a href="#guided-exercise-1---global-raster-statistics" id="toc-guided-exercise-1---global-raster-statistics" class="nav-link" data-scroll-target="#guided-exercise-1---global-raster-statistics"><span class="header-section-number">6.2</span> Guided Exercise 1 - Global raster statistics</a>
  <ul class="collapse">
  <li><a href="#recovering-your-data" id="toc-recovering-your-data" class="nav-link" data-scroll-target="#recovering-your-data"><span class="header-section-number">6.2.1</span> Recovering your data</a></li>
  <li><a href="#global-raster-statistics" id="toc-global-raster-statistics" class="nav-link" data-scroll-target="#global-raster-statistics"><span class="header-section-number">6.2.2</span> Global raster statistics</a></li>
  </ul></li>
  <li><a href="#guided-exercise-2---per-pixel-calculations-with-the-raster-calculator" id="toc-guided-exercise-2---per-pixel-calculations-with-the-raster-calculator" class="nav-link" data-scroll-target="#guided-exercise-2---per-pixel-calculations-with-the-raster-calculator"><span class="header-section-number">6.3</span> Guided Exercise 2 - Per-pixel calculations with the raster calculator</a></li>
  <li><a href="#guided-exercise-3---boolean-logical-operations-with-the-raster-calculator" id="toc-guided-exercise-3---boolean-logical-operations-with-the-raster-calculator" class="nav-link" data-scroll-target="#guided-exercise-3---boolean-logical-operations-with-the-raster-calculator"><span class="header-section-number">6.4</span> Guided Exercise 3 - Boolean (logical) operations with the raster calculator</a></li>
  <li><a href="#guided-exercise-4---raster-reclassification" id="toc-guided-exercise-4---raster-reclassification" class="nav-link" data-scroll-target="#guided-exercise-4---raster-reclassification"><span class="header-section-number">6.5</span> Guided Exercise 4 - Raster reclassification</a></li>
  <li><a href="#guided-exercise-5---raster-vs.-raster-calculations" id="toc-guided-exercise-5---raster-vs.-raster-calculations" class="nav-link" data-scroll-target="#guided-exercise-5---raster-vs.-raster-calculations"><span class="header-section-number">6.6</span> Guided Exercise 5 - raster vs.&nbsp;raster calculations</a></li>
  <li><a href="#guided-exercise-6---vectorizing-rasters" id="toc-guided-exercise-6---vectorizing-rasters" class="nav-link" data-scroll-target="#guided-exercise-6---vectorizing-rasters"><span class="header-section-number">6.7</span> Guided Exercise 6 - Vectorizing rasters</a></li>
  <li><a href="#guided-exercise-7---mosaicking-and-stacking-rasters" id="toc-guided-exercise-7---mosaicking-and-stacking-rasters" class="nav-link" data-scroll-target="#guided-exercise-7---mosaicking-and-stacking-rasters"><span class="header-section-number">6.8</span> Guided Exercise 7 - Mosaicking and Stacking rasters</a></li>
  <li><a href="#guided-exercise-8---raster-image-stretching" id="toc-guided-exercise-8---raster-image-stretching" class="nav-link" data-scroll-target="#guided-exercise-8---raster-image-stretching"><span class="header-section-number">6.9</span> Guided Exercise 8 - Raster image stretching</a>
  <ul class="collapse">
  <li><a href="#independent-exercise---raster-resampling" id="toc-independent-exercise---raster-resampling" class="nav-link" data-scroll-target="#independent-exercise---raster-resampling"><span class="header-section-number">6.9.1</span> Independent Exercise - Raster resampling</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./sec_w3_rasters.html">Week 3 - Raster data</a></li><li class="breadcrumb-item"><a href="./lab_rasters_2.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Lab 6: The raster calculator and other rastery bits</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-labras2" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Lab 6: The raster calculator and other rastery bits</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this lab, we will continue working with rasters, and will learn how to do several new operations using them, including using the all-powerful <em>Raster Calculator</em>. We will also see the effects of <em>raster resampling</em> in practice.</p>
<section id="before-you-start" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="before-you-start"><span class="header-section-number">6.1</span> Before you start!</h2>
<ol type="1">
<li>Go through the Week 3 preparatory session on Canvas, and watch the seminar recording if you have missed it. Also make sure you have completed all labs prior to this one.</li>
</ol>
</section>
<section id="guided-exercise-1---global-raster-statistics" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="guided-exercise-1---global-raster-statistics"><span class="header-section-number">6.2</span> Guided Exercise 1 - Global raster statistics</h2>
<p>In this exercise, we will use the layers from the previous lab to learn about raster statistics and the raster calculator.</p>
<section id="recovering-your-data" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="recovering-your-data"><span class="header-section-number">6.2.1</span> Recovering your data</h3>
<p>At the end of last week’s lab you saved the final results of your project as a zipfile. Retrieve this file, extract the contents, and re-open your project. It should have these four layers in it:</p>
<ul>
<li>Polygon vector layer of the Island of Great Britain</li>
<li>Raster layer of the SRTM digital elevation model (reprojected to EPSG:27700 and masked to the GB island)</li>
<li>Raster file of the CORINE land cover dataset (reprojected to EPSG:27700 and masked to the GB island)</li>
<li>Raster file of the BIOCLIM climatic dataset (reprojected to EPSG:27700 and masked to the GB island)</li>
</ul>
<p>(if this doesn’t work, I have a copy of the files <a href="https://stir-my.sharepoint.com/:u:/g/personal/ala2_stir_ac_uk/Eb28YoDGBM9MlraOgrbiehcBv9Q8BulLcloDNVypXmCUBw?e=DZfrqZ">here</a>. But you should <em>really</em> try to make it work with your own saved data - storing and retrieving prioject data is a key skill you need to develop!)</p>
</section>
<section id="global-raster-statistics" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="global-raster-statistics"><span class="header-section-number">6.2.2</span> Global raster statistics</h3>
<p>Winter is coming, and you want to escape the worst of the cold and rain. You therefore decide to use your GIS skills to find the ideal place to spend your winter in the UK - an urban area with lower precipitation and higher minimum temperatures. For convenience, we will restrict oour search to the Island of Great Britain, as we already have data for it ready to go.</p>
<p>To get started, you would like to know what is the overall range of precipitation and temperature values for the entire island, using the BIOCLIM data. If this was a vector dataset, you would use the <code>Statistical Summary Tool</code> - but it is a raster. What would be the equivalent operation?</p>
<ol class="example" type="1">
<li><p>The tool we need is called <code>Raster Layer Statistics</code>, but it is <em>not</em> located in the <code>Raster</code> menu. Instead, we need to launch the <code>Processing</code> panel ( <img src="https://docs.qgis.org/3.34/en/_images/processingAlgorithm.png" class="img-fluid">. This panel contains a lot of additional GIS functions, and we will use it often now.</p></li>
<li><p>Once you have the <code>Processing</code> panel open, you can either search for <code>Raster Layer Statistics</code> or find it under the <code>Raster analysis</code> heading. Double click on it to launch the tool window. It should look like this:</p></li>
</ol>
<p><img src="images/lab_6/lab_6_fig1_rasterstats.jpg" class="img-fluid"></p>
<p>Looking at the BIOCLIM data description, the two useful pieces of climatic data you need to get statistics for are <em>BIO6 - Minimum Temperature of the Coldest Month</em>, <em>and BIO12 - Annual Precipitation</em>. The BIO variables are ordered in the file, so <em>band 6</em> is BIO6, and <em>Band 12</em> is BIO12.</p>
<ol start="3" class="example" type="1">
<li>In the <code>Raster Layer Statistics</code> window, select the BIOCLIM layer as <code>Input Layer</code> and <code>band 06</code> as band number. You can keep the results as a temporaty file. <code>Run</code> it and <code>Close</code> the window. A new panel will have appeared under the <code>Processing</code> panel, called <code>Results Viewer</code>. It will have an entry called <code>Statistics</code>. Double click on it and take note of the minimum and maximum BIO6 values (-75 and 33).</li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>Do these values seem too extreme for the UK? What is going on here?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The metadata for the BIO layers states that temperature values are scaled by a factor of 10, so you need to divide these numbers by 10 to get proper Celsius units.</p>
</div>
</div>
</div>
<ol start="4" class="example" type="1">
<li>Now repeat the process to get the Min and Max values for BIO12 (532 and 2311)</li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>What are the units for precipitation?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The metadata for the BIO layers states that annual precipitation is given in mm. One milimitre of rain is equal to one liter per squared metre.</p>
</div>
</div>
</div>
</section>
</section>
<section id="guided-exercise-2---per-pixel-calculations-with-the-raster-calculator" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="guided-exercise-2---per-pixel-calculations-with-the-raster-calculator"><span class="header-section-number">6.3</span> Guided Exercise 2 - Per-pixel calculations with the raster calculator</h2>
<p>Although it is easy enough to covert the temperature pixel values to Celsius in our heads, it would be useful to have the data in the proper units, especially if we want to map it later. Let us use the <code>Raster Calculator</code> to apply the conversion factor to all pixels.</p>
<ol start="5" class="example" type="1">
<li>Go to the menu <code>Raster &gt; Raster Calculator</code> to launch the calculator. It will look like this:</li>
</ol>
<p><img src="images/lab_6/lab_6_fig2_rastercalc.jpg" class="img-fluid"></p>
<p>The general idea is similar to the <code>Field Calculator</code>, with a slightly different layout. The top right panel lists all raster <em>bands</em> in the project (so <code>UK_bioclim_BG_GBmasked@19</code> means band 19 of the BIOCLIM raster). The top right panel lets us pick some options for our raster creation, and the bottom panel lets us type expressions.</p>
<ol start="6" class="example" type="1">
<li><p>We need to divide all BIO6 temperature values by 10. Double click on the BIOCLIM band 6 in the bands list to add it to the expression panel, and then add the division by <code>10</code>. On my project, the final expression panel reads as <code>"UK_bioclim_BG_GBmasked@6" / 10</code>, but your BIOCLIM layer may not be named the same as mine. Note that the bottom of the expression panel should say <code>Expression Valid</code>. If it says <code>Expression Invalid</code>, check your typing (did you use the double quotes?)</p></li>
<li><p>For <code>Output Layer</code>, click on the <code>...</code> button and pick a folder to save the new file. Name it <code>UK_bioclim_BG_GBmasked_BIO6_celsius.tif</code>. Leave the rest as default and click in <code>OK</code>.</p></li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>How many bands has your newly created file?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Only one band, holding the results of the calculation.</p>
</div>
</div>
</div>
<p>Every time you enter an expression involving a raster band and a single number in the <code>Raster Calculator</code> you are telling QGIS to apply the same expression to each pixel of that band. In our case, we divided all pixel values by 10.</p>
</section>
<section id="guided-exercise-3---boolean-logical-operations-with-the-raster-calculator" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="guided-exercise-3---boolean-logical-operations-with-the-raster-calculator"><span class="header-section-number">6.4</span> Guided Exercise 3 - Boolean (logical) operations with the raster calculator</h2>
<p>The <code>Raster Calculator</code> also fulfills the role of the vector <code>Select by expression</code> tool for rasters. The result of any raster logical operation is either <code>1</code> (True) or <code>0</code> (False), i.e.&nbsp;a <em>binary raster</em>, sometimes called a <em>raster mask</em>.</p>
<p>Let us find the warmer places in Great Britain. Our highest minimum temperature of the coldest month (BIO6) value was 3.3 degrees, not too far from zero. So let us limit our search to any places that don’t go below 0 Celsius.</p>
<ol start="8" class="example" type="1">
<li>Open the <code>Raster Calculator</code> again, and this time use the expression <code>"UK_bioclim_BG_GBmask_BIO6_celsius@1" &gt; 0</code>. Notice we used here the layer that we just converted to degrees Celsius. Save the results in a proper folder with the name <code>GB_mintemp_gt_0.tif</code> (gt for ‘greater than’) and run the calculation. You should get something like this:</li>
</ol>
<p><img src="images/lab_6/lab_6_fig3_mintemp_gt_0.jpg" class="img-fluid"> By default, QGIS will paint pixels with a value of <code>1</code> white, and <code>2</code> black. So the white areas now show us all regions of Great Britain that <em>on average</em> don’t go below zero in the worst of winter (these are long term climatic averages). Use the <code>Identify Features</code> tool to check if the pixel values are really <code>0</code> and <code>1</code>.</p>
<ol start="9" class="example" type="1">
<li>Now repeat the process for the precipitation layer. Our minimum annual precipitation value was just above 500, so let us limit us to areas under 700mm of precipitation. Save the result as <code>GB_anprec_lt_700.tif</code>.</li>
</ol>
</section>
<section id="guided-exercise-4---raster-reclassification" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="guided-exercise-4---raster-reclassification"><span class="header-section-number">6.5</span> Guided Exercise 4 - Raster reclassification</h2>
<p>An alternative to the <code>Raster Calculator</code> that can be handier when you have multiple ranges to recode is the <code>Reclassify by table</code> tool in the <code>Processing</code> panel, also under the <code>Raster Analysis</code> heading. Find the tool and open it, and you will see this:</p>
<p><img src="images/lab_6/lab_6_fig4_rec_by_table.jpg" class="img-fluid"></p>
<p>Let us use this tool to extract the urban areas from the CORINE dataset. looking at the metadata, the two classes od interest are <code>Continuous Urban Fabric</code> (pixel value 111) and <code>Discontinuous Urban Fabric</code> (112) classes, which are the classes were we would expect existing housing to be located.</p>
<ol start="10" class="example" type="1">
<li>On the <code>Reclassify by table</code> window, pick the CORINE layer as your <code>Raster layer</code>, and <code>band 1</code> as your <code>Band Number</code>. Then click on the <code>...</code> button besides the box to open the <code>Reclassification  table</code>, and fill the table like the figure below. Click to add rows as necessary.</li>
</ol>
<p><img src="images/lab_6/lab_6_fig5_rec_table.jpg" class="img-fluid"></p>
<ol start="11" class="example" type="1">
<li><p>Click on te blue arrow to go back to main tool window, then set the <code>nodata value</code> back to <code>-32768</code>, the <code>Range Boundaries</code> to <code>min &lt;= value &lt;= max</code> and the <code>Output Data Type</code> to <code>Byte</code>. Save it as <code>GB_urban_areas.tif</code>.</p></li>
<li><p>Repeat the process above with the expression .</p></li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>How could you have done the analysis above using the <code>Raster Calculator</code> instead?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You could do <code>"CORINE_BG_GBmask@1" = 111 OR "CORINE_BG_GBmask@1" = 112</code>. Notice how you can use <code>AND</code> and <code>OR</code> to chain logical expressions as you can for vectors - but because computers are dumb, you need to repeat the name of the layer after the <code>OR</code> (and for each additional expression you add).</p>
<p>You could also do ranges, using an expression such as <code>"CORINE_BG_GBmask@1" &gt; 110 AND "CORINE_BG_GBmask@1" &lt; 113</code> (notice the use of <code>AND</code> instead of <code>OR</code> for ranges) since they are consecutive values, or use <code>"CORINE_BG_GBmask@1" &gt;=111 AND "CORINE_BG_GBmask@1" &lt;= 112</code>). Using ranges is more quicker than using <code>=</code> and <code>OR</code> when you have many consecutive values to search for.</p>
</div>
</div>
</div>
</section>
<section id="guided-exercise-5---raster-vs.-raster-calculations" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="guided-exercise-5---raster-vs.-raster-calculations"><span class="header-section-number">6.6</span> Guided Exercise 5 - raster vs.&nbsp;raster calculations</h2>
<p>We now have three <em>raster masks</em> showing us 1) all the GB areas that don’t go below zero Celsius, 2) the areas that have less than 700mm of rain, and 3) the areas that are urban. How can we combine them into a single layer?</p>
<p>The answer to the above question is still the <code>Raster Calculator</code>. We know the pixels we ‘want’ are numbered <code>1</code> on each layer, otherwise they are <code>0</code>. So if we could multiply one layer by the other, i.e.&nbsp;multiply the value of each set of overlapping pixels, we would get a new raster whith values of <span class="math inline">\(1 \times 1 \times 1 = 1\)</span> when both conditions are met, and a result of <span class="math inline">\(0\)</span> if any of the the conditions is not met. This is why binary rasters are also called raster <em>masks</em> - when you multiply any other raster by it, it <em>masks</em> (i.e.&nbsp;zeroes out) anything that is not <code>True</code> in the mask.</p>
<p>Doing it using the <code>Raster Calculator</code> is as simple as it sounds:</p>
<ol start="13" class="example" type="1">
<li>Open the <code>Raster Calculator</code> and enter the expression <code>"GB_anprec_lt_700@1" * "GB_mintemp_gt_0@1" * GB_urban_areas@1</code>. Then save you layer with name <code>UKs_winter_havens.tif</code>.</li>
</ol>
</section>
<section id="guided-exercise-6---vectorizing-rasters" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="guided-exercise-6---vectorizing-rasters"><span class="header-section-number">6.7</span> Guided Exercise 6 - Vectorizing rasters</h2>
<p>The final result of your analysis should consist of only a handful of pixels - such is lifev in the UK. And since these are discrete locations, it may occur to you they would be better represented and visualised as vectors. Turns out we can convert raster to vectors and vice versa:</p>
<ol start="14" class="example" type="1">
<li><p>Go to <code>Raster &gt; Conversion &gt; Polygonize (Raster to Vector)...</code>. In the new window, pick your results layer as the <code>Input Layer</code>, <code>Band 1</code> as the <code>Band number</code>, and leave the rest as default (<code>DN</code> here means <em>digital number</em>, another name for pixel values. Then pick a folder ans save the results as <code>UK_winter_havens_poly.shp</code> (or geopackage if you prefer).</p></li>
<li><p>You will notice that a very large polygon was also created for the 0 areas of the raster. You can then put the new vector layer in editing mode, use the <code>Selection Tool</code> to select this polygon, and then hit the <code>Delete</code> key on your keyboard to get rid of it. Then save the changes and exit edit mode.</p></li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Polygonising rasters can be a very computationally-heavy operation if you have large rasters and/or many scattered pixel values (for example, vectorising the original CORINE layer with all classes). And it is virtually useless for continuous rasters such as temperature or elevation (you would end up with one polygon per pixel as there would be no adjacent pixels with the same value).</p>
<p>So if you start an analysis with raster data, try to do as much as you can in the raster domain, before vectorising anything. But if your raster results represent isolated small regions within a large matrix of ‘no data’ or zero values, then vectorising is a good idea.</p>
</div>
</div>
<p>You now have polygons representing all adjacent areas that were values as ‘1’ in your raster. But many of them are still only one pixel. What if you wanted to have points instead of polygons?</p>
<ol start="16" class="example" type="1">
<li>In the <code>Processing</code> panel, you will find a tool called <code>Raster Pixels to Points</code>, which you can use to generate the points. I’ll leave the detauils to you, but here is a tip: before you use the tool, go the <code>Properties &gt; Transparency</code> of your raster results layer, and set 0 as an <code>Additional Nodata Value</code>. Otherwise <code>Raster Pixels to Points</code> will create one point for every pixel, including the pixels with a value of 0. That’s a lot of points.</li>
</ol>
</section>
<section id="guided-exercise-7---mosaicking-and-stacking-rasters" class="level2" data-number="6.8">
<h2 data-number="6.8" class="anchored" data-anchor-id="guided-exercise-7---mosaicking-and-stacking-rasters"><span class="header-section-number">6.8</span> Guided Exercise 7 - Mosaicking and Stacking rasters</h2>
<p>Raster files are often very large and ‘heavy’, so it is common to distribute them as <em>tiles</em> or <em>scenes</em>, i.e.&nbsp;smaller adjacent pieces that can be merged back together to cover a certain area of interest. For satellite images, it is also common for each image band to be stored as a separate file (unlike regular photos that only have Blue, Red and Geeen bands, satellite images can have several more bands, covering areas of the spectrum we can’t normally see. The Sentinel-2 satellite, for example, has a total of 13 bands:</p>
<table class="table">
<thead>
<tr class="header">
<th>Band</th>
<th>Wavelength</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>B1</td>
<td>443 nm</td>
<td>Ultra Blue (Coastal and Aerosol)</td>
</tr>
<tr class="even">
<td>B2</td>
<td>490 nm</td>
<td>Blue</td>
</tr>
<tr class="odd">
<td>B3</td>
<td>560 nm</td>
<td>Green</td>
</tr>
<tr class="even">
<td>B4</td>
<td>665 nm</td>
<td>Red</td>
</tr>
<tr class="odd">
<td>B5</td>
<td>705 nm</td>
<td>Visible and Near Infrared (VNIR)</td>
</tr>
<tr class="even">
<td>B6</td>
<td>740 nm</td>
<td>Visible and Near Infrared (VNIR)</td>
</tr>
<tr class="odd">
<td>B7</td>
<td>783 nm</td>
<td>Visible and Near Infrared (VNIR)</td>
</tr>
<tr class="even">
<td>B8</td>
<td>842 nm</td>
<td>Visible and Near Infrared (VNIR)</td>
</tr>
<tr class="odd">
<td>B8a</td>
<td>865 nm</td>
<td>Visible and Near Infrared (VNIR)</td>
</tr>
<tr class="even">
<td>B9</td>
<td>940 nm</td>
<td>Short Wave Infrared (SWIR)</td>
</tr>
<tr class="odd">
<td>B10</td>
<td>1375 nm</td>
<td>Short Wave Infrared (SWIR)</td>
</tr>
<tr class="even">
<td>B11</td>
<td>1610 nm</td>
<td>Short Wave Infrared (SWIR)</td>
</tr>
<tr class="odd">
<td>B12</td>
<td>2190 nm</td>
<td>Short Wave Infrared (SWIR)</td>
</tr>
</tbody>
</table>
<p>In this exercise, we will learn how to a) <em>mosaic</em> rasters - ‘glue’ them together side by side to cover a larger area and b) <em>stack</em> rasters - merge the different band files into a single file.</p>
<ol start="17" class="example" type="1">
<li><a href="https://stir-my.sharepoint.com/:u:/g/personal/ala2_stir_ac_uk/EWWIMudbgUlImqIZ5ZYoVw4BNhL1rRn5swLLTvJnli2r_A?e=NIVOuW">Download the data for this specific exercise from this link</a>. It contains four aerial photographs covering the University of Stirling campus and the Wallace Monument area. Extract the data and organise it as usual.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>These images were originally downloaded from the ‘Aerial’ section of Digimap - if you ever need very detailed imagery of the UK land, check it out!</p>
</div>
</div>
<ol start="18" class="example" type="1">
<li>Each image is stored within its own folder, named <code>nsXXXX</code>, where <code>XXXX</code> is a four digit number. <em>Start a new project</em> and load into QGIS all the <code>.tif</code> files in all four folders. There should be six files in total.</li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>What do you think is the meaning of the <code>nsXXXX</code> folder names?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>They indicate tiles in the OS British Grid system.</p>
</div>
</div>
</div>
<p>Notice that the airphoto for tile ns8196 has been provided with its three colour bands (RGB) as separate files - simulating what you would expect for satellite files. To be able to see this aerial photo in colour, we must first <em>stack</em> these bands into a single file. The operation is called <em>stack</em> because you could visualise it as physically stacking them one on top of the other.</p>
<ol start="19" class="example" type="1">
<li>Go to <code>Raster &gt; Miscellaneous &gt; Merge...</code>. You will get a window like this:</li>
</ol>
<p><img src="images/lab_6/lab_6_fig6_merge.jpg" class="img-fluid"> (@) For <code>Input Layers</code>, click on the <code>...</code> button, and a list of all available raster layers in your project will appear. You can drag the layer names to reorder them, and your final selection should the <code>ns8196_R</code>, <code>ns8196_G</code>, and <code>ns8196_B</code> layers, in the order below from top to bottom. This sets the order of the bands inside the file.</p>
<p><img src="images/lab_6/lab_6_fig7_merge_layers.jpg" class="img-fluid"> (@) Once you have selected the layers, click on the blue arrow to go back to the main window, then set the following parameters: <em>check the box</em> for <code>Place each input file into a separate band</code> (that tells QGIS you want a <em>stack</em>), and the <code>Output Data Type</code> to <code>Byte</code>. Then save the resulting file as <code>ns8196_RGB.tif</code>, in the same folder where you had the three separate band files.</p>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>Why do we change <code>Output Data Type</code> to <code>Byte</code>?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The RGB colour system uses one byte (8-bits, 0-255 integer numbers) per colour channel to designate any colour. For example, the University of Stirling official green colour (<img src="images/lab_6/lab_6_fig9_StirColor.jpg" class="img-fluid">) is R=0 G=105 B=56. The <code>Byte</code> option ensures we only use 8-bits per band, and keep the file size smaller. If we left it as <code>Float32</code>, the same 0-225 integer numbers would be stored as 32-bit decimal numbers, quadrupling the size of the file for no reason.</p>
</div>
</div>
</div>
<ol start="20" class="example" type="1">
<li>You should now have a properly colored image for tile ns8196. Remove the three original single band layers from the project and then save it.</li>
</ol>
<p>Everything looks good colour-wise now, bur our airphoto is still actually four separate adjacent photos. That means any processing we may want to do involving the entire area would have to be repeated four times. We can however merge these four tiles in a single airphoto <em>mosaic</em>.</p>
<ol start="21" class="example" type="1">
<li><p>Go back to <code>Raster &gt; Miscellaneous &gt; Merge...</code>. Yes, it is a bit confusing, QGIS uses the same tool for both stacking and mosaicking.</p></li>
<li><p>This time, check the four tiled RGB images as your <code>Input Layers</code> - order doesn’t matter. Then make sure to <strong>not check</strong> the <code>Place each input file into a separate band</code> option. That will tell QGIS you want a mosaic and not a stack. Set the <code>Output Data Type</code> to <code>Byte</code> again, and save it as <code>UoS_RGB_mosaic.tif</code>. You should now have a single airphoto layer covering the entire area. Remove the previous individual layers from the project and save it again.</p></li>
</ol>
</section>
<section id="guided-exercise-8---raster-image-stretching" class="level2" data-number="6.9">
<h2 data-number="6.9" class="anchored" data-anchor-id="guided-exercise-8---raster-image-stretching"><span class="header-section-number">6.9</span> Guided Exercise 8 - Raster image stretching</h2>
<p>When working with multiband color images in a GIS environment, we can often manipulate the contrast of an image by applying different <em>contrast stretches</em> to each band. Especially when working with satellite images, which tend to look a bit ‘faded’ because of the atmospheric effect, stretching can make our images more vivid and easier to interpret.</p>
<ol start="23" class="example" type="1">
<li>Right-click on the airphoto mosaic layer you created and go to <code>Properties &gt; Symbology</code>. You will se that the symbology type is <code>Multiband color</code>, which is the correct choice for representing images. Note that each band is associated to a colour channel (R, G, B), but this association can be changed at will. Change the <code>Red band</code> to band 2, and the <code>Green band</code> to band 1, then <code>Apply</code>. Now the vegetation appears red! Change it back to the proper colour order and <code>Apply</code> again.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is a useful feature when working with satellite images, which often have bands representing spectral regions that we cannot see, such as Near Infrared or Microwave. We can then freely associate these bands to colour channels and create <code>false colour compositions</code> that highlight different surface features. The example below shows the UoS campus as seen from the Sentinel-2 satellite. Here we place Band 13 - Short Wave Infared (SWIR) in the blue channel, Band 8 - Near-Infrared band (NIR) in the green channel, and Band 11 - SWIR in the red channel. Since water does not reflect IR, the loch appears black. Plants reflect strongly in the NIR region so they appear bright green, and bare ground / concrete reflects mostly in the SWIR, thus appearing purplish (red+blue).</p>
<p><img src="images/lab_6/lab_6_fig10_StirSentinel.jpg" class="img-fluid"></p>
</div>
</div>
<ol start="24" class="example" type="1">
<li><p>Notice how the <code>Min</code> and <code>Max</code> values for each band are <code>0</code> and <code>255</code>, meaning we are mapping our screen colours to the entire range of possible values (0-255). But quite often the colours in an image do not cover the entire 8-bit range, so we are ‘wasting’ colour discrimination.</p></li>
<li><p>Change the <code>No Enhancement</code> option to <code>Stretch to Min/Max</code>, and then expand the <code>Min/Max Value Settings</code> heading. Pick the <code>Min/Max</code> option, and select <code>Whole Raster</code> for <code>Statistics Extent</code> and <code>Actual(slower)</code> for <code>Accuracy</code>, then click on <code>Apply</code>. You will see that while band 1 and band 3 do use the entire 0-255 range, band 2 uses the 2-255 range only.</p></li>
</ol>
<p>To further enhance the contrast of images, we can tell QGIS to ‘cut off’ the extreme values of the range, using different methods.</p>
<ol start="26" class="example" type="1">
<li><p>Change the <code>Min/Max Value Settings</code> option to <code>Cumulative Count Cut</code>, and then<code>Apply</code>. Now the <code>Min</code> and <code>Max</code> colour values for each band are (13-189, 29-187,and 31-164 respectively), and the image should look more vivid. What QGIS did was remove the values in the lowest 2% (0.2 percentile) and highest 2% (0.98 percentile) of the existing range before calculating Min/Max values, thus <em>stretching</em> this smaller number range to the full colour range of the screen.</p></li>
<li><p>Progressively increase the lower percentile (i.e.&nbsp;from 2% to 3%) and decrease the upper percentile (i.e.&nbsp;from 98% to 97%) and notice how the contrast gets progressively stronger. If you go too far (i.e.&nbsp;too narrow a range) you will start to see <em>pixel saturation</em> - many of the pixels will be outside the range and thus mapped to fully black or fully white.</p></li>
</ol>
<p>A second way to calculate the stretch is to use standard deviations. You may remember from statistics that when you assume a Normal distribution, a distance of <span class="math inline">\(\pm 1 \sigma\)</span> from the mean will capture about 68% of the data, <span class="math inline">\(\pm 2 \sigma\)</span> will capture 98%, <span class="math inline">\(\pm 3 \sigma\)</span> will capture X % and so on:</p>
<p><img src="images/lab_6/lab_6_fig11_normal.jpg" class="img-fluid"></p>
<ol start="28" class="example" type="1">
<li><p>Change the <code>Min/Max Value Settings</code> option to <code>Mean +/- Standard Deviation x</code>, and leave the multiplier at <code>2</code>. Aplly and check the contrast. Then change the multiplier to <code>1</code> and <code>Apply</code>, and compare the contrast of using <span class="math inline">\(\pm 1 \sigma\)</span> vs.&nbsp;<span class="math inline">\(\pm 2 \sigma\)</span>.</p></li>
<li><p>Set the final image contrast to your linking, and exit the <code>Properties</code> window. Save your project.</p></li>
</ol>
<section id="independent-exercise---raster-resampling" class="level3" data-number="6.9.1">
<h3 data-number="6.9.1" class="anchored" data-anchor-id="independent-exercise---raster-resampling"><span class="header-section-number">6.9.1</span> Independent Exercise - Raster resampling</h3>
<p>As you have learned, raster data consists of a <em>grid</em> of pixel values (i.e.&nbsp;a matrix). So quite often, when working with rasters, you may need to shift the pixels from one grid to another. One main example is raster reprojection - if you reproject your raster to a different CRS, the new raster grid will be aligned with this new CRS, and won’t match the original perfectly, as in the figure below.</p>
<p>FIGURE mismatched grids.</p>
<p>That is why the raster reprojection tool is called <code>Warp(Reproject)</code> - it is as if you are <em>warping</em> the image during the transformation. Other times you may need to make two different raster datasets match the same extent and pixel size, which would also require warping one of the rasters to match the other.</p>
<p>A key step when doing these transformations is choosing a <em>resampling</em> method, i.e.&nbsp;in which way will the original pixel values be transferred to the new grid. The most common and fast method is called <em>Nearest Neighbour</em> (NN) - if you imagine the old and new grids partially overlapping, NN resampling just looks for the closest old pixel to the new pixel, and transfers the value:</p>
<p><img src="images/lab_6/lab_6_fig12_NN.jpg" class="img-fluid" alt="Source:10.13140/RG.2.2.16038.27207"> NN is fast because it requires no additional computations, and also has the benefit of not changing the original data values. But if your data has a lot of fine and/or linear elements, it may result in a ‘jagged’ appearance. For that reason, other methods exist that try to <em>interpolate</em> the new pixel values based on a combination of the original ones. Two common methods are the <em>bilinear</em> and <em>bicubic</em> interpolations, which will average the 4 and 16 closest pixels, respectively. That has the benefit of creating smoother resulting rasters:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/lab_6/lab_6_fig13_resamps.jpg" class="img-fluid figure-img"></p>
<figcaption>Source:10.13140/RG.2.2.16038.27207</figcaption>
</figure>
</div>
<p>Let us now practice our raster skills in an independent exercise, while also demonstrating the effect of resampling:</p>
<ol type="1">
<li>On your UK SRTM layer, find the location of Stirling and the university campus, and then use the <code>Raster &gt; Extraction &gt; Clip Raster by Extent</code> function to clip it to an area similar to the image below. For reference, I am using a <code>Singleband Pseudolcolor</code> symbology with the inverted <code>Spectral</code> colour palette, <em>stretched</em> to the values between 0 and 200m. If you find it hard to find Stirling, use the OpenStreetMap online layer as a reference. Don’t worry about matching my area perfectly, the clip is just to speed up our computations.</li>
</ol>
<p><img src="images/lab_6/lab_6_fig8_StirSRTM.jpg" class="img-fluid"></p>
<ol start="2" type="1">
<li><p>Now use <code>Warp(Reproject)</code> to reproject this dataset back to EPSG:4326, but twice. Do it the first time using <code>Nearest Neighbour</code> as the <code>Resampling method to use</code>, and then a seocnd time using the <code>Cubic(4x4 kernel)</code> resampling method. Remember to pick the correct layer to reproject (it should be your Stirling-clipped SRTM layer). <strong>Hint:</strong> If you save it as a temporaty file, it may not recognise the CRS after the warp - you will see a question mark to the right of the layer name. If that happens, just click on the question mark and pick ESPG:4326 as the CRS.</p></li>
<li><p>Apply a symbology to the original Stirling SRTM that makes it easier for you to see all terrain features. Then use <code>Copy Style</code> and <code>Paste Style</code> to make sure both of the new warped versions have the same symbology.</p></li>
<li><p>Flick back and forth between the original, NN resampled and cubic resampled rasters - can you see how NN results in more ‘jagged’ edges where you have sharp terrain transitions?</p></li>
<li><p>Calculate the global raster statistics for the three layers and assess how much impact NN vs.&nbsp;cubic resampling has had on the new layers, compared to the original.</p></li>
</ol>
<p>One instance where we should <em>always</em> use NN resampling is when we have categorical rasters such as the CORINE dataset. In these cases, any sort of resampling that averages multiple pixel values will create ‘fake’ new numbers that don’t represent any class. Let us test it:</p>
<ol start="6" type="1">
<li><p>Using <code>Raster &gt; Extract &gt; Clip Raster by Extent</code>, clip a portion of the CORINE dataset that matches the extent of the clipped Stirling SRTM layer. Hint: ask QGIS to use the extents of the SRTM clip for the CORINE clip.</p></li>
<li><p>Again, reproject this clipped CORINE dataset using both <code>Nearest Neighbor</code> and <code>Cubic(4x4 kernel)</code>, as you did for the terrain.</p></li>
</ol>
<p>8.Now use the <code>Raster Layer Unique Values Report</code> tool from the <code>Processing</code> panel to count the unique pixel values in the original CORINE clip and the two reprojections. What happened when you used the bicubic resampling?</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./lab_rasters_1.html" class="pagination-link" aria-label="Lab 5: Working with raster data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Lab 5: Working with raster data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./sec_w4_cartography.html" class="pagination-link" aria-label="Week 4 - Making maps">
        <span class="nav-page-text">Week 4 - Making maps</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>