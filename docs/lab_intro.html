<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GEOU9SP GIS Workbook - 1&nbsp; Lab 1: QGIS overview and file management</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./lab_crs.html" rel="next">
<link href="./sec_intro_toGIS.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./sec_intro_toGIS.html">Week 1 - Introduction to GIS</a></li><li class="breadcrumb-item"><a href="./lab_intro.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Lab 1: QGIS overview and file management</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GEOU9SP GIS Workbook</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sec_intro_toGIS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 1 - Introduction to GIS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_intro.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Lab 1: QGIS overview and file management</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_crs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Lab: Coordinate Reference Systems</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#before-you-start" id="toc-before-you-start" class="nav-link active" data-scroll-target="#before-you-start"><span class="header-section-number">1.1</span> Before you start!</a></li>
  <li><a href="#GE1" id="toc-GE1" class="nav-link" data-scroll-target="#GE1"><span class="header-section-number">1.2</span> Guided Exercise 1 - Managing and loading files</a>
  <ul class="collapse">
  <li><a href="#downloading-the-required-data" id="toc-downloading-the-required-data" class="nav-link" data-scroll-target="#downloading-the-required-data"><span class="header-section-number">1.2.1</span> Downloading the required data</a></li>
  <li><a href="#creating-a-project-structure" id="toc-creating-a-project-structure" class="nav-link" data-scroll-target="#creating-a-project-structure"><span class="header-section-number">1.2.2</span> Creating a project structure</a></li>
  <li><a href="#creating-a-qgis-project-and-adding-data-to-it" id="toc-creating-a-qgis-project-and-adding-data-to-it" class="nav-link" data-scroll-target="#creating-a-qgis-project-and-adding-data-to-it"><span class="header-section-number">1.2.3</span> Creating a QGIS project and adding data to it</a></li>
  </ul></li>
  <li><a href="#guided-exercise-2---organizing-and-styling-your-layers" id="toc-guided-exercise-2---organizing-and-styling-your-layers" class="nav-link" data-scroll-target="#guided-exercise-2---organizing-and-styling-your-layers"><span class="header-section-number">1.3</span> Guided Exercise 2 - Organizing and styling your layers</a></li>
  <li><a href="#guided-exercise-3-processing-data-using-gis-operations" id="toc-guided-exercise-3-processing-data-using-gis-operations" class="nav-link" data-scroll-target="#guided-exercise-3-processing-data-using-gis-operations"><span class="header-section-number">1.4</span> Guided Exercise 3: Processing data using GIS operations</a></li>
  <li><a href="#guided-exercise-4-creating-a-map-layout" id="toc-guided-exercise-4-creating-a-map-layout" class="nav-link" data-scroll-target="#guided-exercise-4-creating-a-map-layout"><span class="header-section-number">1.5</span> Guided Exercise 4: Creating a map layout</a></li>
  <li><a href="#independent-exercise-1" id="toc-independent-exercise-1" class="nav-link" data-scroll-target="#independent-exercise-1"><span class="header-section-number">1.6</span> Independent Exercise 1</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./sec_intro_toGIS.html">Week 1 - Introduction to GIS</a></li><li class="breadcrumb-item"><a href="./lab_intro.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Lab 1: QGIS overview and file management</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-exoverview" class="quarto-section-identifier"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Lab 1: QGIS overview and file management</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>The purpose of this lab is to give you a first overview of what a proper GIS workflow looks like, from start to end. As you progress on your exercises the projects will become more complex but the general workflow will not change.</p>
<p>Developing proper project and file management habits from the start is the <em>best</em> thing you can do to succeed in GIS. Speaking as someone who has been teaching and working with Geomatics for more than a decade, poor file/project management is the underlying cause of at least 50% of the GIS problems you may encounter.</p>
<section id="before-you-start" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="before-you-start"><span class="header-section-number">1.1</span> Before you start!</h2>
<ol type="1">
<li><p>Go through the Week 1 preparatory session on Canvas, and watch the seminar recording if you have missed it.</p></li>
<li><p>Read <a href="https://www.ordnancesurvey.co.uk/documents/resources/guide-to-nationalgrid.pdf">this document</a> to understand how the British National Grid indexing system works.</p></li>
</ol>
<!-- end of list -->
</section>
<section id="GE1" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="GE1"><span class="header-section-number">1.2</span> Guided Exercise 1 - Managing and loading files</h2>
<p>In this exercise, you will download some data, prepare a <em>folder structure</em> to organise the files in your GIS projects, then create a QGIS project file and add some GIS data to it.</p>
<section id="downloading-the-required-data" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="downloading-the-required-data"><span class="header-section-number">1.2.1</span> Downloading the required data</h3>
<p>For this practical you will use the “OS open road” and “OS Terrain 50 Digital Terrain Model” spatial datasets, specifically for the <strong>NS89</strong> tile of the Ordnance Survey British National Grid. (Read about what these datasets are here: <a href="https://www.ordnancesurvey.co.uk/products/os-open-roads">OS Open Roads</a> , <a href="https://www.ordnancesurvey.co.uk/products/os-terrain-50">OS Terrain 50</a>).</p>
<ol class="example" type="1">
<li><p>Head to the <a href="https://digimap.edina.ac.uk/">Digimap</a> website, and if you haven’t already, make sure you accept the user licenses for all datasets, as show on the instructions video avaiable on Canvas.</p></li>
<li><p>Go the <code>Ordnance Survey</code> section of the site, and then pick the <code>View maps and download data</code> option on the right.</p></li>
<li><p>Following the steps shown on the instructions video, download the following datasets <em>for the NS89 BNG tile only</em>:</p></li>
</ol>
<ul>
<li>OS Open Roads (under <em>Vector Data</em>)</li>
<li>“OS Terrain 50 Digital Terrain Model” (<em>NOT Terrain 5 and NOT Contours!</em>, under Land and Height Data)</li>
</ul>
<p>If you have correctly searched for tile NS89 and checked the required datatsets, you will see a screen like this:</p>
<p><img src="images/lab_1/lab1_digimap.png" class="img-fluid"></p>
</section>
<section id="creating-a-project-structure" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="creating-a-project-structure"><span class="header-section-number">1.2.2</span> Creating a project structure</h3>
<p>GIS projects generate a lot of different files, and quickly, so project organization is <strong>essential</strong>. The folder structure below is my personal suggestion for organizing GIS projects files and associated data. As you get comfortable managing your own projects, feel free to change the organization structure to something that best suits your own workflow and the specific project you are working on!</p>
<ol start="4" class="example" type="1">
<li>Create a folder on your computer with the module name (<code>GEOU9SP</code>), off of your main work folder. For <strong>Windows</strong> this will usually be <code>Documents</code>. For <strong>Linux</strong> and <strong>Mac</strong>, create it on you <code>home</code> folder. (If you prefer and are comfortable with saving at another location on your computer, go for it!)</li>
</ol>
<p><strong>Windows:</strong></p>
<p><img src="images/lab_1/lab1_fig3_wincfolder.png" class="img-fluid"></p>
<p><strong>mac OS:</strong></p>
<p><img src="images/lab_1/lab1_fig3_macfolder.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>Having complex file paths can sometimes create problems. That is why we try to keep our main projects on a base folder. If you would like to keep a copy of your data on your OneDrive folder you are encouraged to do so, but I don’t recommend working directly from it. That is because the full path to a OneDrive folder will to be very long and likely contain spaces. Mine, for example is <code>C:\Users\Thiago\OneDrive - University of Stirling\Documents</code>. Those spaces in the name may create problems later. So I recommend instead to <em>copy</em> the completed lab data to your OneDrive folder at the end of each lab.</p></li>
<li><p>For the same reason, <strong>never</strong> use spaces or special symbols on your folder and file names. Limit yourself to using letters A-Z and a-z, numbers 1-9 and just the <em>underline</em> (_) and <em>dash</em> (-) symbols.</p></li>
<li><p>Windows <strong>does not</strong> differentiate letter case, so if you create a file named <code>filename1.txt</code> and then a second file named <code>Filename1.txt</code> in the same folder, the second will overwrite the first. Mac OS does differentiate upper and lower case letters, so <code>Filename1.txt</code> and <code>filename1.txt</code> are considered different names and can co-exist in the same folder.</p></li>
</ul>
</div>
</div>
<ol start="5" class="example" type="1">
<li><p>Inside the new <code>GEOU9SP</code> folder, create a subfolder called <code>lab_1</code> (notice I am avoiding spaces by using the underline)</p></li>
<li><p>Inside <code>lab_1</code>, create the following folder structure. On the diagram below, the folder <code>raster</code> is a folder inside the folder <code>01_raw_data</code>, which is inside <code>lab_1</code> and so on.</p></li>
</ol>
<pre><code>.
└── GEOU9SP/
    └── lab_1/
        ├── 00_qgis
        ├── 01_raw_data/
        │   ├── raster
        │   └── vector
        ├── 02_processing
        ├── 03_final_products
        └── 04_notes</code></pre>
<p>I like to start folder names start with double digits so they are kept in order. These folders will be used as follows:</p>
<ul>
<li><p><code>00_qgis</code>: we will use this folder to save our QGIS project files.</p></li>
<li><p><code>01_raw_data</code>: this folder will keep all the original data files you download. This way you can always go back to the start if something goes wrong. You can optionally use the subfolders <code>vector</code> and <code>raster</code> to easily know which kind of data you are working with, but this may not be necessary for small projects. As you obtain data you will create additional subfolders for each individual dataset to keep data organized.</p></li>
<li><p><code>02_processing</code>: here we will keep all the intermediate files you generate as part of your work. Make ample use of subfolders to identify each step of the workflow.</p></li>
<li><p><code>03_final_products</code>: here we will keep the final products of our intended analysis. This makes it easy for us to find the latest version of our final results, without risking confusing it with intermediate files. This can also include maps, reports and any other ’deliverable’resulting from your analysis.</p></li>
<li><p><code>04_notes</code>: here we will keep all our <em>non-GIS</em> files. For example, it may be a good idea to keep a text file documenting the project steps as you work on it. You could also save here screen grabs of specific steps. Again, use subfolders as needed to keep your data tidy.</p></li>
</ul>
<ol start="7" class="example" type="1">
<li>Now move the data you’ve downloaded into your organized project folders and extract (unzip) them if necessary. The terrain data folder (<code>terrain-50-dtm_xxxxxxx</code>) should go into the <code>raster</code> folder within <code>01_raw_data</code> and the roads folder (<code>open-roads_xxxxxxx</code>) into the <code>vector</code> folder. The <code>citations_orders.xxxx.txt</code> and <code>contents_order_xxx</code> text files should go into your <code>04_notes</code> folder. Your folder structure should look like this:</li>
</ol>
<pre><code>.
└── GEOU9SP/
    └── lab_1/
        ├── 00_qgis
        ├── 01_raw_data/
        │   ├── raster/
        │   │   └── OS_terrain_50/
        │   │       └── ...
        │   └── vector/
        │       └── OS_roads/
        │           └── ...
        ├── 02_processing
        ├── 03_final_products
        └── 04_notes</code></pre>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>What are the <code>citations_orders.xxxx.txt</code> and <code>contents_order_xxx</code> files? What information do they contain?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>They are both plain text files. <code>citations_orders.xxxx.txt</code> is very handy as it gives us the proper way to cite the data sources on reports. <code>contents_order_xxx</code> is just a summary of your Digimap order.</p>
</div>
</div>
</div>
<ol start="8" class="example" type="1">
<li>Start a new text file (a Word <em>.doc</em> file or a Notepad <em>.txt</em> file) in your <code>04_notes</code> folder, and write a few lines documenting the steps you took until now. If you prefer handwritten notes on a paper notebook, feel free to use it instead! The important thing is to keep track of the steps you are taking. As projects get more complicated, it is easy to forget which steps we took, and in what order!</li>
</ol>
</section>
<section id="creating-a-qgis-project-and-adding-data-to-it" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="creating-a-qgis-project-and-adding-data-to-it"><span class="header-section-number">1.2.3</span> Creating a QGIS project and adding data to it</h3>
<p>A QGIS project is a file, which will remember all the data layers you have loaded, their stacking order, the styling of each layer, and some other information such as the coordinate reference system. It will also keep any map layouts that you create. <strong>But he project file will NOT store the data files themselves!!</strong>. It will only link to the data. That is why we need good project folder organisation. If a data file is moved or renamed, the QGIS project file will lose track of it.</p>
<ol start="6" type="1">
<li>Create a new project in QGIS by clicking on <code>Project &gt; New...</code> or pressing <em>Ctrl-N</em>:</li>
</ol>
<p><img src="images/lab_1/lab1_fig1_newproject.png" class="img-fluid"></p>
<ol start="9" class="example" type="1">
<li><p>Add to your project the layers <code>NS_RoadLink.shp</code> from the OS Roads dataset and the <code>NS89.asc</code> terrain data from your organized project folders.</p></li>
<li><p>Save your project inside the <code>00_qgis</code> folder. You can save your project by clicking on the <em>Save</em> button, going to <code>Project &gt; Save</code> menu, or by holding the keys <code>Ctrl+S (Command+S on Mac)</code>.</p></li>
<li><p>Open the project settings by clicking on the menu <code>Project &gt; Properties...</code>. You will then see this window:</p></li>
</ol>
<p><img src="images/lab_1/lab1_fig2_projprops.png" class="img-fluid"></p>
<ol start="12" class="example" type="1">
<li><p>The main things to set on your new project are the project home folder, the coordinate reference system (CRS) and the measurement units.</p>
<ul>
<li><p>As the <em>project home</em> on the <code>General</code> tab, select the <code>lab_1</code> folder you created. This helps quick navigation when opening and saving data.</p></li>
<li><p>For <em>measurement units</em>, make sure distance units are set in meters, and area units in squared meters, also on the <code>General</code> tab. Any QGIS operations that calculate distances or areas will use the units set by the project.</p></li>
<li><p>For the CRS, go to the <code>CRS</code> tab and search for <strong>27700</strong> in the <code>Filter</code> box. That is the <em>EPSG code</em> that identifies the <em>OSGB 1936 British National Grid</em> coordinate reference system (CRS). Select it by clicking on it.</p></li>
</ul></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>EPSG stands for “European Petroleum Survey Group”, and designates a database with standard codes for hundreds of coordinate reference systems. Over time, you will probably memorize the EPSG codes for the CRSs you use more often.</p>
</div>
</div>
<ol start="13" class="example" type="1">
<li>Save your project again.</li>
</ol>
</section>
</section>
<section id="guided-exercise-2---organizing-and-styling-your-layers" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="guided-exercise-2---organizing-and-styling-your-layers"><span class="header-section-number">1.3</span> Guided Exercise 2 - Organizing and styling your layers</h2>
<p>One of the most powerful aspects of GIS software is the ability to <em>style</em> spatial data in very specific ways, by specifying colors, line widths, line types, simbols, etc. As we progress in the module you will learn more and more ways to style your data.</p>
<ol start="14" class="example" type="1">
<li><p>On the <code>Layers panel</code> to the left of the screen, select the <code>NS89</code> layer, and drag it to the bottom of the layers list if not there already.</p></li>
<li><p>Turn the roads layer off for now, by unchecking the box besides its name.</p></li>
<li><p>Right-click on the <code>NS89</code> layer name and choose <code>Rename Layer</code>. Rename it to <code>Digital Elevation Model (50m)</code>.</p></li>
<li><p>Open the file explorer in your system, and find the <code>NS89.asc</code> file that holds the actual elevation data, which you downloaded from Digimap.</p></li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>Will changing a layer name in the layer panel also change the name of the source data file for that layer?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>No, layer names within the project are independent of file names - but as default QGIS will use the file name as layer name when you add new data. But you should always change them into nice, readable and properly spelled names within your project, where you are free to use spaces. The actual file name linked by the project will stay the same and can always be seen by right-clicking on the layer name and selecting <code>Properties...&gt; Information</code>.</p>
</div>
</div>
</div>
<ol start="18" class="example" type="1">
<li><p>Right click on the newly renamed terrain layer and choose <code>Zoom to Layer</code>. This is a very handy tool to “find yourself” if you end up zooming or panning the map too far.</p></li>
<li><p>Right click on the terrain layer name again and select <code>Properties...</code>, then go to the <code>Symbology</code> tab.</p></li>
<li><p>On the <code>Min</code> and <code>Max</code> boxes, type <code>0</code> and <code>500</code> respectively. This determines the range of layer values to be visualised.</p></li>
<li><p>Select <code>Rendering type</code> to be <code>Single Band Pseudocolor</code>, and change the <code>Color ramp</code> option by clicling on the down-arrow button to the right and picking the <code>spectral</code> colour ramp. If you click on the colour ramp itself it will open a new window to custmize it. This is now what we need for now, so just close it and use the down-arrow.</p></li>
<li><p>Click on <code>Classify</code> (under the dropdown menu that says * Mode: continuous*). The colours will be matched to the range of elevation values in the layer.</p></li>
<li><p>Click again on the down-arrow button and select <code>Invert Color Ramp</code> at the top of the options, so that the lowest heights are coloured blue. Then click on <code>OK</code>.</p></li>
<li><p>Note how the legend for you terrain layer has changed on the Layers panel. it now shows the minimum and maximum elevations and the colour ramp. Save your project.</p></li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>Why do we bother inverting the colour ramp for this dataset?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We should always try to use colours that reinforce map interpretation. The color blue is usually associated with water, and water accumulates on the lowest elevations, so setting the lowest elevations to blue helps map users read and interpret the map.</p>
</div>
</div>
</div>
<ol start="25" class="example" type="1">
<li><p>Rename the <code>NS_RoadLink</code> layer to <code>Road Network</code>.</p></li>
<li><p>Go to its <code>Symbology</code> properties, like you did for the terrain layer, Notice that the symbology options are data-specific (vector vs.&nbsp;raster). Seclet <code>Simple Line</code> in the symbology window (under the main <code>Line</code> option). Then under the window, go to the <code>Color</code> option an click on the down-arrow menu to change the line color to a dark grey. If you click on the actual colour, a more complex colour-picking window will appear. You can use either the quicker colour dropdown or the main colour window, whatever you prefer.</p></li>
<li><p>Change the <code>Stroke width</code> (line width) to 0.3. Click <code>OK</code>. Reactivate the layer if needed to visualise it.</p></li>
</ol>
</section>
<section id="guided-exercise-3-processing-data-using-gis-operations" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="guided-exercise-3-processing-data-using-gis-operations"><span class="header-section-number">1.4</span> Guided Exercise 3: Processing data using GIS operations</h2>
<p>The core of GIS work is to use the many built-in operations (also known as functions or tools) of GIS software to <em>process</em> the data in some way, and thus create additional information. For this exercise, we will use an operation that creates a new layer representing the boundaries of the terrain data layer, and then use a second operation to cut the roads layer to the same shape and extent as this new layer.</p>
<ol start="28" class="example" type="1">
<li><p>Go to the <code>Vector</code> menu and select <code>Research Tools &gt; Extract Layer Extent...</code>. Select the terrain layer as your <code>Input layer</code>, and click <code>Run</code> to generate a <em>temporary layer</em>. Temporary layers are not kept once you close QGIS, unless you save it manually later. The <code>Extract Layer Extent</code> window will not close automatically after you run the operation, so click on <code>Close</code> when you are done.</p></li>
<li><p>Go to <code>Vector &gt; Geoprocessing Tools &gt; Clip...</code>. Select the roads layer as the <code>Input Layer</code> and the new temporary layer as the <code>Overlay Layer</code>.</p></li>
<li><p>This time, we will save the output. Click on the <code>...</code> button to the right of the <code>Clipped</code> text box, and then choose <code>Save to file</code>. Save your new layer on the folder <code>GEOU9SP/lab_1/02_processing/</code>, naming it <code>clipped_roads.shp</code>. Make sure the <code>SHP file</code> format is selected below the file name. Then click on <code>Run</code> to execute the operation. Close the window.</p></li>
<li><p>Turn the original roads layer on and off to see the result of your operation. Then right-click on the original roads layer, and select <code>Styles &gt; Copy Style &gt; All Style Categories</code>. Then right click on the new (clipped) roads layer and select <code>Styles &gt; Paste Style &gt; All Style Categories</code>. This is a great way top style several layers ion the same way wirthout effort.</p></li>
<li><p>Remove the original roads layer from your project by right clicking on it and selecting <code>Remove Layer...</code>, and then rename you clipped layer to “Roads”. Save your project.</p></li>
<li><p>Close QGIS. <strong>It will give you a warning</strong> - read it carefully and then confirm it.</p></li>
<li><p>Reopen QGIS, and load back your project. Notice it remembers exactly where you last saved it, including zoom level, layer names and layer styles. The “Extent” layer will still be on your list, but will appear empty - it has been deleted once you closed QGIS. Remove it from the project and save again.</p></li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="a">
<li><p>What are the names of the two GIS functions you just used in this exercise?</p></li>
<li><p>Why did you have to create a new layer representing the extent of the terrain data before <em>clipping</em> the roads layer?</p></li>
<li><p>What does the warning given by QGIS when you closed your project means?</p></li>
</ol>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="a">
<li><p>The functions are called <code>Clip</code> and <code>Extract Layer Extent</code>.</p></li>
<li><p>The <code>Clip</code> function requires two <em>vector</em> files as input, but the terrain data is a <em>raster</em> file (i.e.&nbsp;an image). The <code>Extract Layer Extent</code> creates a vector file representing the extent of any given layer. Each specific tool will require different kinds of data to work properly. We will learn more about vectors and rasters on weeks 2 and 3.</p></li>
<li><p>When we created the extent layer, we produced a <em>temporary layer</em>, which is discarded by QGIS when the program is closed. QGIS was letting you know that will happen, to give you the chance to go back and save it. Temporary layers are also lost when QGIS crashes (yes when, not if - it will happen). So never use them for important stuff - only for quick tests if you are not sure what the output of a function will be.<br>
</p></li>
</ol>
</div>
</div>
</div>
</section>
<section id="guided-exercise-4-creating-a-map-layout" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="guided-exercise-4-creating-a-map-layout"><span class="header-section-number">1.5</span> Guided Exercise 4: Creating a map layout</h2>
<p>The main QGIS interface (or any other GIS software) is developed and optimised for interactive work. But very often as part of our GIS analysis we will want to generate nice maps and figures following proper design rules (and not just grabbing a screen capture of the QGIS window and dumping it on a page - hint for your assignment reports). For that, we use the QGIS <strong>Map Layout Editor</strong>.</p>
<ol start="35" class="example" type="1">
<li><p>Click on <code>Project &gt; New Print Layout</code> and name it <code>Lab 1 Layout</code>. A new window will open showing the QGIS Layout Editor. Notice that the main QGIS window remains open as well. These windows are ‘linked’, so that the map layout reflects any styling changes you make on the main window.</p></li>
<li><p>Add a new map to the layout by clicking on the <img src="https://docs.qgis.org/testing/en/_images/mActionAddMap.png" class="img-fluid"> icon. Drag it through the page so it covers about 2/3 of it horizontally, and the full height of the page (minus some borders).</p></li>
<li><p>Use the <code>Interactive Extent</code> tool <img src="https://docs.qgis.org/testing/en/_images/mActionMoveItemContent.png" class="img-fluid"> to pan (click and grag) and zoom (mouse wheel) until your data covers the entire map box. But make sure you don’t hide the edges of the data by zooming in too much!</p></li>
<li><p>Now fine tune the map scale by changing the <code>Scale</code> value on the bottom right panel. Remember that this value means “1:value”, i.e.&nbsp;one unit on the page is equal to that many units (value) in the real world. This means larger numbers will “zoom out”, and smaller numbers will “zoom in”. Try to make the map fill as much as possible of the map box, without clipping the edges.</p></li>
<li><p>Go to the menu <code>Add Item &gt; Add Legend...</code> in the Map Layout Window (or guess the icon for this option on the side toolbar). Click the area beside the map box and drag to add a legend.</p></li>
<li><p>Go back to the main QGIS window, right click on the terrain layer name, then select <code>Properties...</code>, and on the <code>Symbology</code> tab, change the <code>Mode</code> under the class color box to <code>Equal Interval</code>. Then select the number of <code>Classes</code> to 10 (to the right of the <code>Equal Interval</code> box). Go back top the Map Layout editor.</p></li>
<li><p>Go to the menu <code>Add Item &gt; Add Scalebar</code> in the Map Layout Window (or guess the icon for this option on the side toolbar). Click and drag in the area below the legend to add it to the map layout.</p></li>
<li><p>Add a title to your map using the <code>Add Label...</code> tool (either on the <code>Add Item</code> menu or selecting the tool directly from the left sidebar). You can change the text by replacing the “Lorem ipsum” placeholder text with your own text on the left pane. Try to make it <strong>bold</strong> with a font size of 16 (hint: always use the down-arrow buttons for ‘quick settings’).</p></li>
<li><p>Rearrange the items on the page until you are pleased with the results. Then go to <code>Layout &gt; Export as PDF...</code>, and export your map, naming it properly and saving it on <code>GEOU9SP/lab_1/final_products</code>. It is a good idea to export as PDF if you want your map to be a standalone document. If you are exporting to insert the map into a report, then use <code>Layout &gt; Export as Image...</code> instead.</p></li>
</ol>
<p>For reference, my map looked like this at this stage:</p>
<p><img src="images/lab_1/lab1_fig6_mapzoom.png" class="img-fluid"></p>
<ol start="44" class="example" type="1">
<li>Then close the Map Layout window, save your project on the main QGIS window, and close QGIS. Reopen QGIS, and go to <code>Project &gt; Layout Manager</code>. The layout you created previously should appear on the list. Select it and click on <code>Show</code> to reopen the Map Layout window.</li>
</ol>
<p><strong>Congratulations!</strong> You have successfully finished your first GIS project, using proper file management practices! As a final suggestion, create a “workflow_notes” file on <code>GEOU9SP/lab1/notes</code> and write up a quick overview of what you did, along with any specific notes you would like to remember later.</p>
</section>
<section id="independent-exercise-1" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="independent-exercise-1"><span class="header-section-number">1.6</span> Independent Exercise 1</h2>
<p>At the end of each lab, you will have the opportunity to reinforce what you learned by going through ‘independent’ exercises. These will use the same operations you learned with the guided exercises, but it may require you to figure out small bits of new functionality, and will not have step by step instructions.</p>
<p>As the module progresses, the independent exercises will give you less and less directions, to reflect real-world GIs usage. <strong>Make sure you do the independent exercises</strong> - it is easy to fall into a false sense of ‘<em>I got this</em>’ when only following step-by-step directions.</p>
<ol type="1">
<li><p>Create a new project folder structure for this project, under your main GEOU9SP work folder.</p></li>
<li><p>Download the zipfile containing the Air Photo Mosaic and the Stirling Council Geospatial Data from <a href="">here</a>.</p></li>
<li><p>Extract the data from the zipfiles and move them to the proper project folders.</p></li>
<li><p>Open QGIS and create a new project that uses the OSGB British Grid (EPSG 27700) coordinate reference system.</p></li>
<li><p>Import the airphoto raster image and the vector files for Buildings, Roads, Railway Track, Electricity Transmission Lines, and Functional Sites into your QGIS project.</p></li>
<li><p>Organize your layers so that, from top to bottom, you have transmission lines, railways, roads, buildings, functional sites, and then the airphoto image.</p></li>
<li><p>Style your layers so that transmission lines are styled as thin dashed red lines, railways as thick white lines, roads as thick grey lines, buildings as filled yellow polygons and functional sites with a thick dark blue outline and no fill colour (hint: check the <code>Fill style</code> options).</p></li>
<li><p><code>Clip</code> all your vector layers to the extent of the airphoto image.</p></li>
<li><p>Create a map layout covering the entire extent of the airphoto. Add a title, legend and scale bar to your layout and export it as a PNG image. Then insert your exported file as a figure into a MS Word document.</p></li>
</ol>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click here to see what the final layout should look like.">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click here to see what the final layout should look like.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><img src="images/lab_1/lab1_fig7_indmap.png" class="img-fluid"></p>
</div>
</div>
</div>
<ol start="10" type="1">
<li>Now answer the questions below:</li>
</ol>
<ul>
<li><p>How far is the Pathfoot Building from the Cottrell Bulding? Calculate it both “as the crow flies” (linear distance) and as if you were walking. (Hint: use the <a href="https://docs.qgis.org/3.34/en/docs/user_manual/map_views/map_view.html#sec-measure">Measuring</a> tool).</p></li>
<li><p>What is the total surface area of the water bodies in the University of Stirling Campus? (Hint: also the Measuring tool).</p></li>
<li><p>What is the classification of the UoS campus polygon within the “Functional Site” layer? (Hint: use the <a href="https://docs.qgis.org/3.34/en/docs/user_manual/introduction/general_tools.html#identify">Indentify Features</a> tool).</p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./sec_intro_toGIS.html" class="pagination-link" aria-label="Week 1 - Introduction to GIS">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Week 1 - Introduction to GIS</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./lab_crs.html" class="pagination-link" aria-label="Lab: Coordinate Reference Systems">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Lab: Coordinate Reference Systems</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>