<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GEOU9SP GIS Workbook - 13&nbsp; Lab 13 - Densities and distances</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./sec_w10_gnss.html" rel="next">
<link href="./sec_w8_spatial_analysis_III.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./sec_w8_spatial_analysis_III.html">Week 8 - Spatial analysis III</a></li><li class="breadcrumb-item"><a href="./lab_dist_dens.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Lab 13 - Densities and distances</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GEOU9SP GIS Workbook</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sec_w1_intro_toGIS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 1 - Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Lab 1: QGIS overview and file management</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_crs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Lab 2: Coordinate Reference Systems</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sec_w2_vectors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 2 - Vector data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_vectors_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Lab 3: Working with vector attributes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_vectors_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Lab 4: Working with vector geometries</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sec_w3_rasters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 3 - Raster data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_rasters_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Lab 5: Working with raster data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_rasters_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Lab 6: The raster calculator and other rastery bits</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sec_w4_cartography.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 4 - Making maps</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_carto_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Lab 7: Making Maps - Part I</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_carto_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Lab 8: Making Maps - Part II</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sec_w5_spatial_analysis_I.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 5 - Spatial analysis I</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_catchup1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Lab 9 - Catch Up / Assignment Work session</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_geoprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Lab 10: Geoprocessing tools</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sec_w6_spatial_analysis_II.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 6 - Spatial analysis II</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Lab 11 - Data Joins</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_zonal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Lab 12 - Zonal Statistics and Overlap Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./sec_w8_spatial_analysis_III.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 8 - Spatial analysis III</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lab_dist_dens.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Lab 13 - Densities and distances</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Week 10 - Obtaining spatial data in the field</span></span>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#guided-exercise-1---obtaining-and-organising-the-data" id="toc-guided-exercise-1---obtaining-and-organising-the-data" class="nav-link active" data-scroll-target="#guided-exercise-1---obtaining-and-organising-the-data"><span class="header-section-number">13.1</span> Guided Exercise 1 - Obtaining and organising the data</a></li>
  <li><a href="#guided-exercise-2---looking-for-crime-hotspots" id="toc-guided-exercise-2---looking-for-crime-hotspots" class="nav-link" data-scroll-target="#guided-exercise-2---looking-for-crime-hotspots"><span class="header-section-number">13.2</span> Guided Exercise 2 - Looking for crime hotspots</a></li>
  <li><a href="#guided-exercise-3---looking-more-closely" id="toc-guided-exercise-3---looking-more-closely" class="nav-link" data-scroll-target="#guided-exercise-3---looking-more-closely"><span class="header-section-number">13.3</span> Guided Exercise 3 - Looking more closely</a></li>
  <li><a href="#guided-exercise-4---visualizing-densities-as-isolines" id="toc-guided-exercise-4---visualizing-densities-as-isolines" class="nav-link" data-scroll-target="#guided-exercise-4---visualizing-densities-as-isolines"><span class="header-section-number">13.4</span> Guided Exercise 4 - Visualizing densities as isolines</a></li>
  <li><a href="#guided-exercise-5---distance-to-hubs" id="toc-guided-exercise-5---distance-to-hubs" class="nav-link" data-scroll-target="#guided-exercise-5---distance-to-hubs"><span class="header-section-number">13.5</span> Guided Exercise 5 - Distance to Hubs</a></li>
  <li><a href="#guided-exercise-6---distance-maps" id="toc-guided-exercise-6---distance-maps" class="nav-link" data-scroll-target="#guided-exercise-6---distance-maps"><span class="header-section-number">13.6</span> Guided Exercise 6 - Distance Maps</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./sec_w8_spatial_analysis_III.html">Week 8 - Spatial analysis III</a></li><li class="breadcrumb-item"><a href="./lab_dist_dens.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Lab 13 - Densities and distances</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Lab 13 - Densities and distances</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="guided-exercise-1---obtaining-and-organising-the-data" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="guided-exercise-1---obtaining-and-organising-the-data"><span class="header-section-number">13.1</span> Guided Exercise 1 - Obtaining and organising the data</h2>
<p>For this set of exercises, we will be working with crime occurrence data for the city of New York (USA), for the year 2023. You have been hired to support an analysis of NYC criminality to help better manage police resources and reduce crime.</p>
<p>The data package for this exercise can be downloaded here, and has been obtained from City of New York <a href="https://www.nyc.gov/site/nypd/stats/crime-statistics/citywide-crime-stats.page">Police Department website</a> and the <a href="https://opendata.cityofnewyork.us/">NYC Open Data hub</a>, and contains the following:</p>
<ul>
<li><p>Arrest incidents for the year 2023, as a point vector shapefile - derived from a shapefile containing all arrest incidents from 2013 to present.</p></li>
<li><p>A polygon vector shapefile with the boundaries for the NYC neighbourhoods.</p></li>
<li><p>A polygon vector shapefile with the boundaries of each <a href="https://www.nyc.gov/site/nypd/bureaus/patrol/find-your-precinct.page">Police Precinct</a> in NYC. Each police precinct is the responsibility of a different police team.</p></li>
<li><p>A point vector shapefile with the locations of all police stations in NYC. Most precincts have one station, with a few exceptions for additional speciality police stations such as mounted police.</p></li>
</ul>
<ol class="example" type="1">
<li>Download and extract the data package, and create a new folder and QGIS project for this lab. Import all three layers to your project. If you wish, add the OpenStreet Map or some other web layer from the <code>QuickMapServices</code> plugin to help with context and navigation.</li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>Zoom to the full extent of the arrests layer - can you spot a problem with it? How can you fix it?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You can right click on the layer name and then on <code>Zoom to Layer(s)</code>. Apparently, an arrest has been made near Africa…This is a common error when people enter missing coordinates as zero instead of a blank value - and then the point will be located at 0 degrees lat / 0 degrees long. To fix it, select the problematic point using the ’Select Features` tool in the toolbar, then put the arrests layer into editing mode, delete the point, save the edits and exit edit mode.</p>
<p>If you skip this step your density rasters will get quite big…</p>
</div>
</div>
</div>
</section>
<section id="guided-exercise-2---looking-for-crime-hotspots" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="guided-exercise-2---looking-for-crime-hotspots"><span class="header-section-number">13.2</span> Guided Exercise 2 - Looking for crime hotspots</h2>
<p>The first question you have been asked is where are the crime <em>hotspots</em> in the city, meaning the areas with the largest <em>density</em> of occurrences. The word density usually refers to a count of things divided by some area or volume measurement. For example, population density is number of people; oxygen density in normal atmospheric conditions is 1.43 grams / litre.</p>
<p>In GIS, density will be usually related to counts of things over areas; the more ‘things’ happen per unit area for ex. km<span class="math inline">\(^2\)</span>, the higher the density. This is often called <em>Hotspot analysis</em> in GIS, where the hotspots are areas of remarkably high density. And the main tool used for that is known as <em>Kernel Density Estimation (KDE)</em>. I have made a video explanation on KDE that you can watch on Canvas.</p>
<ol start="2" class="example" type="1">
<li>The first way to generate a density map is to use change the layer <code>Symbology</code>. Select the crime layer and go to <code>Properties &gt; Syymbology</code>, then change the symbology type from <code>Single Symbol</code> to <code>Heatmap</code>. Pick <code>Rocket</code> as the <code>Color ramp</code>, and a <code>Radius</code> of 1000 <code>meters at scale</code> (change from <code>millimiters</code>). Then <code>Apply</code> and <code>Close</code>. To add some context, place the boroughs layer on top of it, with no fill and a bright yellow outline.</li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="A">
<li><p>Based on the hotspot map, which police precincts seems to have their hands full with crime occurrences? And what neighbourhood is it?</p></li>
<li><p>What is the CRS of the datasets (which should be also set as the CRS for the project)? What datum, projection and coordinate system does it use?</p></li>
</ol>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="A">
<li><p>We can use the <code>Identify Features</code> tool to query the precinct and neighbourhood layers. The 14th precinct seems to deal with the highest crime hotspot, which is mainly located in Midtown South Manhattan.</p></li>
<li><p>We can find that by looking at the <code>Properties &gt; Information</code> for any of the layers. The CRS is EPSG:2831 - NAD83(HARN) / New York Long Island. It uses the NAD83 datum, the Lambert Conformal Conic Projection and metric coordinates.</p></li>
</ol>
</div>
</div>
</div>
<p>The <code>heatmap</code> symbology is useful for a quick inspection, but it is also restrictive. It would be more useful if the heatmap was an actual layer. We can create such permanent heatmap using the <code>Heatmap (Kernel Density Estimation)</code> tool in the <code>Processing</code> panel, under the <code>Interpolation</code> category. Once you open it, it will give you a few more options than the symbology route, in the following window:</p>
<ol start="3" class="example" type="1">
<li><p>Pick the crime layer as your <code>Point Layer</code>, then set a radius of 1000 <code>meters</code> (or 1 <code>kilometers</code>). One important additional option here is that we get to set the <em>resolution</em> (pixel size) of our output raster density map. Smaller pixels will look smoother, but will result in larger files and longer processing times. The units here are the same as the layer CRS, so let us use <code>50</code> meters for both <code>X</code> and <code>Y</code>. Leave the <code>Kernel Shape</code> as quartic and the other options as default. Save your result in an appropriate location with the name <code>crime_density_1km_quartic_50m.tif</code>.</p></li>
<li><p>Notice how the output of <code>Heatmap (Kernel Density Estimation)</code> is a raster, and that <em>nodata</em> values are used for regions that not within 1km of any point (unlike the <code>Heatmap</code> symbology, which paints everything as a zero). Since it is a raster, we can style it with symbology options just the same as any raster. Pick a <code>Singleband pseudocolor</code> colour ramp for your hotspots, and use the same ramp you used for the <code>Heatmap</code> symbology.</p></li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>Does the heatmap produced as a layer look the same as the heatmap produced by the symbology?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>They look close, but not identical. Kernel density estimations are very sensitive to the kernel radius, the shape of the kernel function, the scaling, and the resolution of the output raster, and you can get wildly different results by manipulating these parameters. Therefore KDE is considered a <em>semi-quantitative</em> tool - there is never as <em>correct</em> or <em>best</em> set of parameters to use for generating the maps.</p>
</div>
</div>
</div>
<ol start="5" class="example" type="1">
<li><p>To demonstrate the above, generate a second heatmap layer, this time using 5km as <code>Radius</code>, a <code>Pixel size</code> of <code>100</code> metres, the <code>Uniform</code> kernel shape, and <code>Scaled</code> output values. Not only the layer looks very different, but the actual location of the hotspots seem to have changed, and the density units are also very different. It always takes a lot of trial and error to converge on a KDE estimation that is sensible for the problem at hand.</p></li>
<li><p>If you’d like, try different combinations of radii, kernel shapes and pixel sizes. Once you are done, remove them all from your project, leaving only the first density map we created (radius 1000, quartic kernel, pixel size 50m).</p></li>
<li><p>To make the hotspot layer look better, create a new layer by using <code>Dissolve</code> on the precincts or neighbourhood layers, then <code>Mask</code> the density raster to the boundaries of NYC only.</p></li>
<li><p>We can now use tools we already know to associate the crime density information to the precincts and neighbourhoods. Using <code>Zonal Statistics</code> ([#sec-spatan3]), extract the <code>mean</code> and <code>maximum</code> density values for each precinct. Then make one visualization colouring the polygons by average crime density, and the other by maximum crime density. Repeat the analysis for the neighbourhoods polygon.</p></li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>Which precinct and neighbourhood seem to be the most problematic in terms of crime, <em>i.e.</em> have the highest average and/or maximum crime density?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The zonal statistics analysis confirms our visual analysys that Midtown / Midtown South Manhattan has the highest maximum and average densities of arrest incidents. Not suprsingly, the <a href="https://www.nyc.gov/site/nypd/bureaus/patrol/precincts/midtown-south-precinct.page">14th Precinct</a>, also knownas Midtown South Precinct, also has the highest average and maximum density.</p>
</div>
</div>
</div>
</section>
<section id="guided-exercise-3---looking-more-closely" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="guided-exercise-3---looking-more-closely"><span class="header-section-number">13.3</span> Guided Exercise 3 - Looking more closely</h2>
<p>Our incident dataset however includes several types, from traffic violations, to serious crimes. The <code>law_cat_cd</code> field contains codes indentifying the type of incident.</p>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>What are the unique existing values for the <code>law_cat_cd</code> field?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We can use the <code>Select by Expression</code> tool from the Attribute Table, then select the <code>law_cat_cd</code> field and ask for a list of its unique values. From less serious to more serious, the values are: I = Infraction, V = Violation, M = Misdemeanor, F = Felony. We also have what appear to be some missing values (<code>NULL</code>) and some wrong entries (<code>9</code>).</p>
</div>
</div>
</div>
<p>It may be that if we give different weights to crime according to their seriousness, our results change. But for that, we need a numeric attribute that indicates the weight to be given to each type of crime. To do that, we will learn a new function that can be used in the <code>Field Calculator</code>, the <code>CASE WHEN</code> conditional operator.</p>
<ol start="9" class="example" type="1">
<li>Open the attribute table for the arrest incidents layer, and then open the <code>Field Calculator</code>. Then enter the <code>CASE</code> expression like shown on the figure below. The syntax is quite self explanatory: once you type <code>CASE</code>, you <em>open</em> what we call a <em>block</em>. Inside the block, you then list a series of conditions (i.e.&nbsp;<em>cases</em>) for what value the new attribute should have for different values of <code>law_cat_cd</code>. At the last line in the block you add the <code>ELSE</code> operator, meaning that if none of the cases is matched, then the new attribute should have a value of 0. That would include the ‘NULL’s and the ’9’ values that are not informative to us. You then <em>close</em> the block with <code>END</code>. We have more than 600k entries, so it will take a while!</li>
</ol>
<p><img src="images/lab_13/lab13_fig_case.jpg" class="img-fluid"></p>
<ol start="10" class="example" type="1">
<li>Now repeat the <code>Heatmap (Kernel Density)</code> calculation you did before, using a <code>radius</code> of 1000 meters, 50m ‘X’ and ‘Y’ pixel sizes, the <code>Quartic</code> <code>Kernel Shape</code> with <code>Raw</code> values, but this time pick the new <code>crim_weigh</code> field for <code>Weight from Field</code>. Save your results with an informative name such as <code>crime_density_1km_quartic_50m_weighted.tif</code> and check the results.</li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>How much did the results change?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Not much, but we can see incident density being reduced or increased in some areas after the weighting, especially a reduction in the northern part of precinct 11th, in the Bronx neighbourhood.</p>
</div>
</div>
</div>
</section>
<section id="guided-exercise-4---visualizing-densities-as-isolines" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="guided-exercise-4---visualizing-densities-as-isolines"><span class="header-section-number">13.4</span> Guided Exercise 4 - Visualizing densities as isolines</h2>
<p><em>Isolines</em> or ‘contour lines’ are lines that delineate areas within the same ranges of values. The most common use for them is to indicate topography:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://media.hswstatic.com/eyJidWNrZXQiOiJjb250ZW50Lmhzd3N0YXRpYy5jb20iLCJrZXkiOiJnaWZcL3RvcG9ncmFwaGljLW1hcC1jb250b3VyX3YyLmpwZyIsImVkaXRzIjp7InJlc2l6ZSI6eyJ3aWR0aCI6ODI4fSwidG9Gb3JtYXQiOiJhdmlmIn19.png" class="img-fluid figure-img"></p>
<figcaption>https://www.mapquest.com/travel/outdoor-activities/hiking/how-to-read-a-topographic-map.htm</figcaption>
</figure>
</div>
<p>However, we can use isolines to show any type of continuous value surface. For weather prediction, for example, contour lines indicating zones of equal pressure are called <em>isobars</em> :</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://bam.files.bbci.co.uk/bam/live/content/zdjngk7/large.png" class="img-fluid figure-img"></p>
<figcaption>https://www.bbc.co.uk/bitesize/guides/zqwpm39/revision/2</figcaption>
</figure>
</div>
<p>We can therefore, visualise density maps as contour lines. This has the advantage of making it easier to overlay on top of other information. To create an isoline map from our crime hotspots, we have two options. The first is to use the <code>Symbology</code>, the second is to create a new layer.</p>
<ol start="11" class="example" type="1">
<li><p>The density values on our crime density layer are very small, and that may throw the symbology options off. So we will first scale the densities to a relative percentage. First go to the <code>Processing</code> panel and find the <code>Raster Layer Statistics</code> tool. Use it to find the maximum density value for the layer. Mine was 0.09126630425453186. Then head to the <code>Raster Caclulator</code> and create a new layer named <code>relative_density.tif</code>, by dividing all pixels of the crime density layer by the maximum (<code>"NYC_crime_heatmap_1km_quartic@1" \ 0.09126630425453186</code> in my case, but your layer may be named differently.)</p></li>
<li><p>Select the new relative crime density layer you created and go to <code>Properties &gt; Symbology</code>. It should be set to <code>singleband gray</code> - switch the symbology type to <code>Contours</code>. The default values for the contours and the index contours are too high (they are adjusted for elevation), so let us use 0.1 as the contour interval, and 0.5 as the index contour. Pick a colour for the isolines that differentiates well from the colour palette of your density layer, and overlay both. Now make a map that uses only the contours to show the crime hotspots over the OpenStreetMap layer, together with the Neighbourhood layer.</p></li>
<li><p>Now turn off this contour styled layer, and instead go to <code>Raster &gt; Extraction &gt; Contour...</code>. Pick your relative density layer as <code>Input Layer</code>, and 0.1 as the <code>Interval between contour lines</code>. For attribute name, enter <code>REL_DENS</code>, leave the rest as default and save the result as <code>isolines_relative_density.shp</code>. The output should be identical to the symbology option, but it will a new line vector layer that can be treated as any other layer.</p></li>
</ol>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>Challenge: can you add labels to the contour lines using the label options in QGIS?</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>If you need some help, take a look a t this step by step: <a href="https://mapscaping.com/mastering-contour-lines-and-labels-in-qgis/">https://mapscaping.com/mastering-contour-lines-and-labels-in-qgis/</a></p>
</div>
</div>
</div>
</section>
<section id="guided-exercise-5---distance-to-hubs" class="level2" data-number="13.5">
<h2 data-number="13.5" class="anchored" data-anchor-id="guided-exercise-5---distance-to-hubs"><span class="header-section-number">13.5</span> Guided Exercise 5 - Distance to Hubs</h2>
<p>Continuing with our crime analysis, we now want to get insights on possible response times to incidents, based on the distance from police stations. There are different ways to represent and explore distances in GIS, and we already explored one of them: buffers. You can create buffers that represent specific distances, and then use these buffers to count ocurrences within the range.</p>
<div class="callout callout-style-default callout-important callout-titled" title="Stop and Think">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop and Think
</div>
</div>
<div class="callout-body-container callout-body">
<p>Can you calculate the percentage of crime incidents in the dataset that happened within 1 km of a police station? Hint: <code>Buffer</code> and <code>Count Points in Polygons</code> should do the trick.</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Click for answer">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click for answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>First select the police station point layer and go to <code>Vector &gt; Geoprocessign &gt; Buffer</code> to create the 1km buffers. Make sure you dissolve them, since your question is within 1km of <em>any</em> station, and there may be places where the buffers of nearby police stations overlap. Then use <code>Count Points in Polygons</code> to count how many crime incidents occurred within the buffer. Then divide this number by the total number of records in the crime incidence dataset. I got 423223 points in the buffer, which divided by 616835 crime incident records gives me 68.6%.</p>
</div>
</div>
</div>
<p>But now let’s say we want to know the <em>average</em> distance of a crime incident to the nearest police station. For this, we would need to know the exact distances for each point, and buffers won’t give us that. The tool we want in that case is <code>Distance to the Nearest Hub (Points)</code> tool, in the <code>Processing</code> panel.</p>
<ol start="14" class="example" type="1">
<li><p>Open the <code>Distance to the Nearest Hub (Points)</code> tool in the <code>Processing</code> panel. Then pick the crime incident layer as the <code>Source Points Layer</code>, and the police station layer as the <code>Destination hubs layer</code>. Pick <code>FACNAME</code> as the hub layer name attribute (the name of each police station), and <code>Meters</code> as the <code>Distance unit</code>, save it as <code>crime_incidents_with_hubs.shp</code>, then <code>Run</code>. It will take a while (after all, QGIS needs to look into each of the 616835 crimes one by one and determine which police station is nearest).</p></li>
<li><p>Now open the attribute table of the new layer your created. It should have all the original attributes of the crime incident layer, plus two new attributes at the end: <code>HubName</code> and <code>HubDist</code>. You can then use the <code>Summary Tool</code> to find out the average for the <code>HubDist</code> attribute, and answer the question above (I got 749 meters). And since the name of the police station is also brought to the table, you could use <code>Statistics by Category</code> (<code>Processing</code> panel) to calculate the total or average number of nearest crime incidents per police station - that could give insight in how overwhelmed some stations could be in relation to others. Or you could calculate the average distances to each hub, and have an idea of which police stations are being responsible for covering the largest areas.</p></li>
</ol>
</section>
<section id="guided-exercise-6---distance-maps" class="level2" data-number="13.6">
<h2 data-number="13.6" class="anchored" data-anchor-id="guided-exercise-6---distance-maps"><span class="header-section-number">13.6</span> Guided Exercise 6 - Distance Maps</h2>
<p>There are times, however, where you want to create a <em>distance map</em> - a layer that shows for every location how far it is from something else. For example, if you were planning the location to install a new wind turbine, you may want to prioritise areas that are closer to a power line. In our crime example, maybe we want to identify regions in the city that are too far away from any police station - and therefore good candidates for creating a new one. The tool for that is called <code>Proximity (raster distance)</code> in QGIS. This tool however only works with rasters, so we need to convert our police stations into a raster first</p>
<ol start="16" class="example" type="1">
<li><p>Go to <code>Raster &gt; Conversion &gt; Rasterize</code>. Then pick the police stations as <code>Input Layer</code>, and <code>1</code> as a <code>Fixed value to burn</code>. then pick <code>Georeferenced Units</code> for <code>Output raster size units</code>, pick <code>50</code> for both horizontal and vertical resolution (those would be meters), and set the <code>Output Extent</code> to match the neighbourhoods layer extent - click ion the small down arrow, then pick <code>Calculate from layer</code> and select the neighbourhoods layer. This option determines how large your raster will be. Set the <code>Output data type</code> to <code>Byte</code>, and then save the result as <code>police_stattions.tif</code>. You will get a raster with a pixel value of <code>1</code> wherever a police station exists, and zero (which is the default <code>nodata</code> option, so it will show as such) otherwise.</p></li>
<li><p>Now open the <code>Proximity (raster distance)</code> tool in the <code>Processing</code> panel, under <code>Raster Analysis</code>. Pick the rasterized police stations as the <code>Input Layer</code>, and add the number <code>1</code> as the <code>List of pixel values....</code> option. Change the distance units to <code>Georeferenced coordinates</code>, leave the rest as default, and save the output as <code>dist_from_police_Stations.tif</code> and <code>Run</code> it. The resulting layer is a raster map where the pixel values represent actual distances from a police station.</p></li>
</ol>
<ul>
<li>raster calc to density cutoff and ditance cutoff ad example of multicriteria analysis</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./sec_w8_spatial_analysis_III.html" class="pagination-link" aria-label="Week 8 - Spatial analysis III">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Week 8 - Spatial analysis III</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./sec_w10_gnss.html" class="pagination-link" aria-label="Week 10 - Obtaining spatial data in the field">
        <span class="nav-page-text">Week 10 - Obtaining spatial data in the field</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>